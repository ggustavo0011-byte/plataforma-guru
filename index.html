<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="google-site-verification" content="uw4onbu5jUlFjqE71aVAImMi3AnurmMkqwKLdBBdpII" />
    <title>Guru da El√©trica - Ajuda em Engenharia e Circuitos</title>
    <meta name="description" content="Plataforma de ajuda universit√°ria para estudantes de Engenharia El√©trica.">
    <style>
        /* --- RESET E BASE --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        body { background-color: #121212; color: #e0e0e0; height: 100vh; overflow: hidden; }
        .oculto { display: none !important; }
        
        /* --- CORES E VARI√ÅVEIS --- */
        :root {
            --primary: #0095f6;
            --bg-dark: #121212;
            --bg-card: #1e1e1e;
            --sidebar: #000000;
            --text-main: #fff;
            --text-muted: #aaa;
            --border: #333;
            --status-analise: #2196f3;
            --status-proposta: #ff9800;
            --status-contra: #9c27b0;
            --status-verif: #e91e63;
            --status-pago: #4caf50;
            --status-final: #607d8b;
            --danger: #d32f2f;
        }

        /* LAYOUT 1: TELA DE LOGIN */
        .split-screen { display: flex; height: 100vh; width: 100%; }
        .left-side-showcase { flex: 1; position: relative; display: flex; align-items: flex-end; padding: 60px; overflow: hidden; background-color: #000; }
        
        .slide-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center; opacity: 0; animation: imageSlide 15s infinite; z-index: 0; }
        .slide-img:nth-child(1) { background-image: url('https://images.unsplash.com/photo-1517077304055-6e89abbf09b0?q=80&w=1476&auto=format&fit=crop'); animation-delay: 0s; }
        .slide-img:nth-child(2) { background-image: url('https://images.unsplash.com/photo-1581092334651-ddf26d9a09d0?q=80&w=1470&auto=format&fit=crop'); animation-delay: 5s; }
        .slide-img:nth-child(3) { background-image: url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=1472&auto=format&fit=crop'); animation-delay: 10s; }
        
        @keyframes imageSlide { 
            0% { opacity: 0; transform: scale(1); } 
            10% { opacity: 1; transform: scale(1.05); } 
            33% { opacity: 1; transform: scale(1.1); } 
            43% { opacity: 0; transform: scale(1); } 
            100% { opacity: 0; } 
        }

        .overlay-dark { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.3)); z-index: 1; }
        .showcase-content { position: relative; z-index: 2; max-width: 500px; text-shadow: 2px 2px 10px rgba(0,0,0,0.8); }
        .showcase-content h1 { font-size: 44px; margin-bottom: 15px; color: #fff; font-weight: 800; line-height: 1.1; }
        
        .auth-container { flex: 1; background-color: #121212; z-index: 3; display: flex; flex-direction: column; justify-content: center; align-items: center; border-left: 1px solid #222; }
        .container-auth { width: 400px; max-width: 90%; padding: 40px; }
        .box { background-color: var(--bg-card); border: 1px solid var(--border); padding: 40px; border-radius: 12px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        /* LAYOUT 2: DASHBOARD */
        .app-layout { display: flex; height: 100vh; width: 100%; background: var(--bg-dark); }
        .sidebar { width: 260px; background: var(--sidebar); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; }
        .sidebar-logo { font-size: 24px; font-weight: bold; color: #fff; margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
        .sidebar-logo span { color: var(--primary); }
        
        .nav-menu { flex: 1; display: flex; flex-direction: column; gap: 10px; }
        .nav-item { padding: 12px 15px; border-radius: 8px; color: var(--text-muted); cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 10px; font-weight: 500; border: none; background: transparent; text-align: left; width: 100%; font-size: 14px; }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.1); color: #fff; }
        .nav-item.danger { color: var(--danger); margin-top: auto; }
        .nav-item.danger:hover { background: rgba(211, 47, 47, 0.1); }

        .main-content { flex: 1; overflow-y: auto; padding: 30px; position: relative; }
        .main-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .user-welcome h2 { font-size: 24px; color: #fff; }
        .user-welcome p { color: var(--text-muted); font-size: 14px; }
        
        .guru-hero-card { background: linear-gradient(135deg, #1e1e1e, #252525); border: 1px solid var(--border); border-radius: 12px; padding: 25px; display: flex; align-items: center; gap: 20px; margin-bottom: 30px; }
        .requests-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; }
        .request-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; display: flex; flex-direction: column; gap: 10px; transition: transform 0.2s; position: relative; }
        .request-card:hover { transform: translateY(-2px); border-color: #555; }
        
        .logo { font-size: 32px; margin-bottom: 30px; font-family: 'Segoe UI', sans-serif; color: #fff; font-weight: bold; }
        .logo span { color: #0095f6; }
        input, select, textarea { width: 100%; padding: 12px; margin-bottom: 12px; background-color: #262626; border: 1px solid #444; color: #fff; border-radius: 6px; font-size: 14px; }
        button.btn-primary, a.btn-primary { width: 100%; padding: 12px; background-color: var(--primary); border: none; color: #fff; font-weight: bold; border-radius: 6px; cursor: pointer; font-size: 14px; transition: 0.2s; display: inline-block; text-align: center; text-decoration: none; box-sizing: border-box; }
        button.btn-primary:hover, a.btn-primary:hover { opacity: 0.9; }
        button:disabled { background-color: #333 !important; color: #666 !important; cursor: not-allowed; }
        button.btn-danger, a.btn-danger { background-color: var(--danger); color: #fff; }
        button.btn-secondary { background: transparent; border: 1px solid #555; color: #ccc; margin-top: 5px; }
        
        .tabs-header { display: flex; gap: 20px; border-bottom: 1px solid var(--border); margin-bottom: 20px; }
        .tab-link { padding: 10px 0; background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 14px; position: relative; }
        .tab-link.active { color: var(--primary); font-weight: bold; }
        .tab-link.active::after { content: ''; position: absolute; bottom: -1px; left: 0; width: 100%; height: 2px; background: var(--primary); }
        .req-status { padding: 4px 10px; border-radius: 20px; font-weight: bold; font-size: 11px; text-transform: uppercase; align-self: flex-start; }
        .btn-delete-req { position: absolute; top: 15px; right: 15px; background: transparent; border: none; color: var(--danger); cursor: pointer; font-size: 18px; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); z-index: 200; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-box { background-color: var(--bg-card); width: 600px; max-width: 95%; border-radius: 12px; border: 1px solid var(--border); padding: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); max-height: 90vh; overflow-y: auto; }
        
        .custom-file-upload { display: block; padding: 15px; cursor: pointer; background: #262626; color: #ccc; border-radius: 8px; border: 1px dashed #555; text-align: center; transition: 0.2s; margin-top: 10px; }
        .custom-file-upload:hover { border-color: var(--primary); color: #fff; background: #2a2a2a; }
        input[type="file"] { display: none; }
        .pix-display-key { background: #fff; color: #000; padding: 15px; border-radius: 8px; font-weight: bold; font-size: 16px; text-align: center; word-break: break-all; margin: 15px 0; border: 2px dashed var(--status-pago); }
        .profile-large-img { width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 20px; background-size: cover; background-position: center; border: 3px solid var(--primary); background-color: #333; }
        .rating-stars { display: flex; justify-content: center; gap: 5px; margin-bottom: 10px; }
        .star { font-size: 30px; cursor: pointer; color: #444; }
        .star.selected { color: #ffeb3b; }
        .review-item { background: #181818; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 3px solid var(--primary); }
        .review-header { display: flex; justify-content: space-between; font-size: 12px; color: #aaa; margin-bottom: 5px; }
        .review-stars { color: #ffeb3b; font-size: 14px; }

        @media (max-width: 900px) { 
            .left-side-showcase { display: none; } 
            .auth-container { border-left: none; }
            .app-layout { flex-direction: column; }
            .sidebar { width: 100%; height: auto; flex-direction: row; padding: 10px; overflow-x: auto; border-bottom: 1px solid var(--border); border-right: none; align-items: center; justify-content: space-between; }
            .sidebar-logo { margin-bottom: 0; margin-right: 15px; font-size: 18px; white-space: nowrap; }
            .nav-menu { flex-direction: row; }
            .nav-item { padding: 8px 12px; white-space: nowrap; }
            .requests-grid { grid-template-columns: 1fr; }
            .guru-hero-card { flex-direction: column; text-align: center; }
        }
    </style>
</head>
<body>

    <div id="tela-acesso" class="split-screen">
        <div class="left-side-showcase">
            <div class="slide-img"></div><div class="slide-img"></div><div class="slide-img"></div><div class="overlay-dark"></div>
            <div class="showcase-content"><h1>Seu Guru de Engenharia.</h1><p>Receba ajuda personalizada agora.</p></div>
        </div>
        <div class="auth-container">
            <div id="box-login" class="container-auth">
                <div class="box">
                    <h1 class="logo">Guru<span>El√©trica</span></h1>
                    <form id="formLogin">
                        <input type="text" id="login-user" placeholder="Email" required>
                        <input type="password" id="login-pass" placeholder="Senha" required>
                        <button type="submit" class="btn-primary">Entrar na Plataforma</button>
                    </form>
                    <div style="margin-top:15px; font-size:13px; color:#aaa;">
                        <a href="#" id="link-esqueci" style="color:#aaa; text-decoration: underline;">Esqueci minha senha</a>
                        <br><br>
                        N√£o tem conta? <a href="#" id="link-cadastro" style="color:var(--primary);">Cadastre-se</a>
                    </div>
                </div>
            </div>
            <div id="box-cadastro" class="container-auth oculto">
                <div class="box">
                    <h1 class="logo">Criar Conta</h1>
                    <form id="formCadastro">
                        <input type="text" id="cad-nome" placeholder="Nome completo" required>
                        <input type="email" id="cad-email" placeholder="Email" required>
                        <input type="tel" id="cad-zap" placeholder="WhatsApp (DDD+Num)" required>
                        <input type="text" id="cad-curso" placeholder="Curso" required>
                        <input type="password" id="cad-pass" placeholder="Senha" required>
                        <button type="submit" class="btn-primary">Cadastrar</button>
                    </form>
                    <p style="margin-top:15px; font-size:13px; color:#aaa;">J√° tem conta? <a href="#" id="link-login" style="color:var(--primary);">Voltar</a></p>
                </div>
            </div>
        </div>
    </div>

    <div id="tela-dashboard" class="app-layout oculto">
        <aside class="sidebar">
            <div class="sidebar-logo">‚ö° Guru<span>El√©trica</span></div>
            <nav class="nav-menu">
                <button class="nav-item active" id="nav-pedidos">üìù Meus Pedidos</button>
                <button class="nav-item" id="nav-perfil">üë§ Meu Perfil</button>
                <button class="nav-item oculto" id="nav-config-guru">‚öôÔ∏è Config Guru</button>
                <button class="nav-item oculto" id="nav-reclamacoes">üì¢ Reclama√ß√µes</button>
                <button class="nav-item" id="nav-fazer-reclamacao">üì¢ Reclamar</button>
                <button class="nav-item" id="nav-ajuda">‚ùì Ajuda</button>
                <button class="nav-item danger" id="btn-sair">üö™ Sair</button>
            </nav>
        </aside>

        <main class="main-content">
            <div class="main-header">
                <div class="user-welcome"><h2 id="welcome-msg">Bem-vindo!</h2><p id="welcome-sub">Painel de Controle</p></div>
                <div id="mini-guru-card" style="display:flex; align-items:center; gap:10px; background:var(--bg-card); padding:8px 15px; border-radius:30px; border:1px solid var(--border);">
                    <div id="header-guru-img" style="width:30px; height:30px; border-radius:50%; background:#333; background-size:cover;"></div>
                    <span style="font-size:12px; font-weight:bold;">Guru Online</span>
                    <button id="btn-ver-quali-header" style="background:none; border:none; color:var(--primary); font-size:11px; cursor:pointer;">Ver Qualifica√ß√µes</button>
                </div>
            </div>

            <div id="guru-hero-card" class="guru-hero-card">
                <div id="guru-avatar-img" style="width: 80px; height: 80px; border-radius: 50%; background-color: #333; background-size: cover; background-position: center; border: 2px solid var(--primary); flex-shrink: 0;"></div>
                <div>
                    <h2 id="guru-title" style="margin-bottom: 5px; font-size: 20px; color: #fff;">Guru da El√©trica</h2>
                    <p id="guru-subtitle" style="color: #aaa; margin-bottom: 10px; font-size: 14px;">Especialista em Circuitos e Projetos</p>
                    <button id="btn-ver-quali" style="background: none; border: 1px solid var(--primary); color: var(--primary); padding: 5px 15px; border-radius: 4px; cursor: pointer; font-size: 12px; transition: 0.2s;">Ver Qualifica√ß√µes Completas</button>
                </div>
            </div>
            <div id="view-pedidos">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <div class="tabs-header" style="margin-bottom:0; border:none;">
                        <button class="tab-link active" data-tab="aberto">Em Aberto</button>
                        <button class="tab-link" data-tab="andamento">Em Andamento</button>
                        <button class="tab-link" data-tab="finalizado">Finalizados</button>
                    </div>
                    <button class="btn-primary" id="btn-novo-pedido" style="width:auto;">+ Novo Pedido</button>
                </div>
                <div id="lista-pedidos" class="requests-grid"></div>
            </div>

            <div id="view-perfil-aluno" class="profile-section oculto">
                <div class="profile-large-img" style="background-image:none; display:flex; align-items:center; justify-content:center; font-size:40px;">üë§</div>
                <h2 style="text-align:center; margin-bottom:30px;">Editar Perfil</h2>
                <form id="formPerfilAluno">
                    <label>Seu Nome</label><input type="text" id="perf-nome">
                    <label>WhatsApp</label><input type="text" id="perf-zap">
                    <label>Curso</label><input type="text" id="perf-curso">
                    <label>Bio</label><textarea id="perf-bio"></textarea>
                    <button type="submit" class="btn-primary">Salvar Altera√ß√µes</button>
                </form>
            </div>

            <div id="view-perfil-guru-edit" class="profile-section oculto">
                <div id="preview-avatar" class="profile-large-img"></div>
                <div style="text-align:center; margin-bottom:20px;">
                    <label for="upload-foto" style="cursor:pointer; color:var(--primary);">Alterar Foto</label>
                    <input id="upload-foto" type="file" accept="image/*">
                </div>
                <h2 style="text-align:center; margin-bottom:20px;">Editar Meu Perfil P√∫blico</h2>
                <form id="formPerfilGuruEdit">
                    <input type="hidden" id="conf-img-base64"><input type="hidden" id="conf-pdf-base64"> 
                    <label>T√≠tulo</label><input type="text" id="conf-titulo">
                    <label>Subt√≠tulo</label><input type="text" id="conf-sub">
                    <label>Bio</label><textarea id="conf-bio" style="height:120px;"></textarea>
                    <label style="color:#2196f3;">Lattes</label><input type="url" id="conf-lattes">
                    <label style="color:#2196f3;">Curr√≠culo PDF</label><label for="upload-pdf-curriculo" class="custom-file-upload">üìé Selecionar PDF</label><input type="file" id="upload-pdf-curriculo" accept=".pdf"><div id="display-pdf-name" style="font-size:12px; color:#888; text-align:center; margin-bottom:15px;">Nenhum arquivo</div>
                    <button type="submit" id="btn-save-perf-guru" class="btn-primary">Salvar Perfil</button>
                </form>
            </div>

            <div id="view-config-guru" class="profile-section oculto">
                <h2 style="text-align:center; margin-bottom:30px;">Configura√ß√µes & Pagamento</h2>
                <form id="formConfigGuru">
                    <label style="color:var(--status-pago);">Chave PIX</label><input type="text" id="conf-pix" style="border-color:var(--status-pago);">
                    <label style="color:var(--status-verif); margin-top:20px;">Alterar Senha</label><input type="password" id="conf-nova-senha">
                    <button type="submit" class="btn-primary btn-admin" style="margin-top:20px;">Salvar Configura√ß√µes</button>
                </form>
            </div>

            <div id="view-reclamacoes" class="oculto">
                <h2 style="color:var(--danger); margin-bottom:20px;">Painel de Reclama√ß√µes</h2>
                <div id="lista-reclamacoes-admin" class="requests-grid"></div>
            </div>
        </main>
    </div>

    <div id="modal-qualificacoes" class="modal-overlay oculto"><div class="modal-box"><h3>Sobre o Guru</h3><div id="qualificacoes-texto" style="margin:15px 0 20px; color:#ccc; line-height:1.5; white-space:pre-wrap;"></div><div style="display:flex; gap:10px; margin-bottom:20px;"><a id="btn-link-lattes" href="#" target="_blank" class="btn-primary" style="display:none; background:#333; flex:1; border:1px solid #555;">üåê Lattes</a><a id="btn-link-pdf" href="#" target="_blank" class="btn-primary" style="display:none; background:#333; flex:1; border:1px solid #555;">üìÑ PDF</a></div><h4 style="border-top:1px solid #333; padding-top:15px; margin-bottom:15px; color:#ffeb3b;">Avalia√ß√µes</h4><div id="lista-avaliacoes-publicas" style="max-height:200px; overflow-y:auto;"></div><button class="btn-close-modal" style="width:100%; padding:10px; background:transparent; border:none; color:#aaa; cursor:pointer; margin-top:20px;">Fechar</button></div></div>
    <div id="modal-reset-senha" class="modal-overlay oculto"><div class="modal-box" style="width:400px; text-align:center;"><h3>Recuperar Senha</h3><p style="font-size:13px; color:#aaa; margin-bottom:20px;">Voc√™ receber√° um e-mail oficial.</p><input type="email" id="reset-email" placeholder="E-mail"><button id="btn-enviar-reset" class="btn-primary">Enviar</button><button class="btn-close-modal" style="width:100%; margin-top:10px; background:transparent; border:none; color:#aaa;">Cancelar</button></div></div>

    <div id="modal-pedido" class="modal-overlay oculto">
        <div class="modal-box"><h3>Novo Pedido</h3><form id="formPedido" style="margin-top:15px;"><input type="text" id="ped-materia" placeholder="Mat√©ria" required><input type="text" id="ped-titulo" placeholder="T√≠tulo" required><textarea id="ped-desc" placeholder="Descri√ß√£o..." style="height:80px;" required></textarea><label for="ped-file" class="custom-file-upload">üìé Anexar Arquivo (PDF/ZIP/IMG)</label><input type="file" id="ped-file"><div id="file-name-display" style="font-size:12px; color:#aaa; margin-top:5px; text-align:center;">Nenhum arquivo</div><div id="file-warning-display" style="font-size:11px; color:#ffeb3b; margin-top:2px; text-align:center; display:none;">‚ö†Ô∏è Arquivo Grande: Ser√° enviado pelo WhatsApp</div><button type="submit" class="btn-primary" style="margin-top:10px;">Enviar Pedido</button></form><button class="btn-close-modal" style="width:100%; padding:10px; background:transparent; border:none; color:#aaa; cursor:pointer;">Cancelar</button></div>
    </div>

    <div id="modal-proposta" class="modal-overlay oculto">
        <div class="modal-box"><h3>Enviar Proposta</h3><form id="formProposta"><input type="hidden" id="prop-id"><input type="number" id="prop-valor" placeholder="Valor (R$)" required><textarea id="prop-msg" placeholder="Detalhes..." required></textarea><button type="submit" class="btn-primary btn-admin">Enviar no WhatsApp</button></form><button class="btn-close-modal" style="width:100%; padding:10px; background:transparent; border:none; color:#aaa; cursor:pointer;">Cancelar</button></div>
    </div>

    <div id="modal-contraproposta" class="modal-overlay oculto">
        <div class="modal-box"><h3 style="color:var(--status-contra);">Fazer Contraproposta</h3><form id="formContra"><input type="hidden" id="contra-id"><input type="number" id="contra-valor" placeholder="Sua oferta (R$)" required><textarea id="contra-msg" placeholder="Motivo..." required></textarea><button type="submit" class="btn-primary" style="background:var(--status-contra);">Enviar Oferta</button></form><button class="btn-close-modal" style="width:100%; padding:10px; background:transparent; border:none; color:#aaa; cursor:pointer;">Cancelar</button></div>
    </div>

    <div id="modal-pagamento" class="modal-overlay oculto">
        <div class="modal-box" style="text-align:center;"><h3>Realizar Pagamento</h3><p style="color:#aaa; font-size:14px;">Fa√ßa um PIX para a chave abaixo:</p><div id="display-valor-pix" style="font-size:24px; color:var(--status-pago); font-weight:bold; margin:10px 0;">R$ 0,00</div><div class="pix-display-key"><span id="display-chave-pix">CARREGANDO...</span></div><button id="btn-copiar" class="btn-primary" style="background:#333;">Copiar Chave</button><div style="margin-top:20px; border-top:1px dashed #444; padding-top:15px; text-align:left;"><p style="font-size:12px; color:#aaa;">‚ö†Ô∏è Anexe o comprovante:</p><label for="pay-file" class="custom-file-upload">üìé Enviar Comprovante</label><input type="file" id="pay-file" accept="image/*,.pdf"><div id="pay-file-display" style="font-size:11px; color:#888; margin-top:5px; text-align:center;">Nenhum arquivo</div><div id="pay-warning-display" style="font-size:11px; color:#ffeb3b; margin-top:2px; text-align:center; display:none;">‚ö†Ô∏è Arquivo Grande: Ser√° enviado pelo WhatsApp</div></div><button id="btn-confirmar-pag" class="btn-primary" style="background:var(--status-pago); margin-top:10px;" disabled>J√° Fiz o Pagamento</button><button class="btn-close-modal" style="width:100%; padding:10px; background:transparent; border:none; color:#aaa; cursor:pointer;">Cancelar</button></div>
    </div>

    <div id="modal-entrega" class="modal-overlay oculto">
        <div class="modal-box"><h3>Entregar Trabalho</h3><label for="entrega-file" class="custom-file-upload">üìé Anexar Resolu√ß√£o</label><input type="file" id="entrega-file"><div id="entrega-file-display" style="font-size:11px; color:#888; margin-top:5px;">Nenhum arquivo</div><div id="entrega-warning-display" style="font-size:11px; color:#ffeb3b; margin-top:2px; display:none;">‚ö†Ô∏è Arquivo Grande: Ser√° enviado pelo WhatsApp</div><button id="btn-confirmar-entrega" class="btn-primary" style="margin-top:15px;" disabled>Finalizar e Entregar</button><button class="btn-close-modal" style="width:100%; padding:10px; background:transparent; border:none; color:#aaa; cursor:pointer;">Cancelar</button></div>
    </div>

    <div id="modal-reclamacao" class="modal-overlay oculto"><div class="modal-box"><h3 style="color:var(--danger);">Registrar Problema</h3><form id="formReclamacao" style="margin-top:15px;"><input type="text" id="rec-titulo" placeholder="Assunto" required><textarea id="rec-msg" placeholder="Descreva o problema..." required style="height:100px;"></textarea><button type="submit" class="btn-primary btn-danger">Enviar</button></form><button class="btn-close-modal" style="width:100%; padding:10px; background:transparent; border:none; color:#aaa; cursor:pointer;">Cancelar</button></div></div>
    <div id="modal-avaliacao" class="modal-overlay oculto"><div class="modal-box" style="text-align:center;"><h3 style="color:#ffeb3b;">Avaliar Guru</h3><div class="rating-stars" id="star-container"><span class="star" data-val="1">‚òÖ</span><span class="star" data-val="2">‚òÖ</span><span class="star" data-val="3">‚òÖ</span><span class="star" data-val="4">‚òÖ</span><span class="star" data-val="5">‚òÖ</span></div><textarea id="aval-msg" placeholder="Coment√°rio..." style="height:80px;"></textarea><button id="btn-enviar-aval" class="btn-primary" style="margin-top:10px;">Enviar</button><button class="btn-close-modal" style="width:100%; padding:10px; background:transparent; border:none; color:#aaa; cursor:pointer;">Cancelar</button></div></div>

    <div id="modal-ajuda" class="modal-overlay oculto"><div class="modal-box"><h3>Ajuda</h3><details class="faq-item"><summary>Pagamentos?</summary><p>Via PIX manual.</p></details><div class="danger-zone" style="margin-top:20px; border-top:1px solid #333; padding-top:10px;"><p style="font-size:12px; color:#aaa; margin-bottom:10px;">Deseja encerrar seu v√≠nculo?</p><a href="https://wa.me/5583981023942?text=Ol%C3%A1%2C%20gostaria%20de%20solicitar%20a%20exclus%C3%A3o%20da%20minha%20conta." target="_blank" class="btn-primary btn-danger" style="display:block; text-align:center; text-decoration:none; line-height: 40px;">Excluir Minha Conta (WhatsApp)</a></div><button class="btn-close-modal" style="width:100%; padding:10px; background:transparent; border:none; color:#aaa; cursor:pointer;">Fechar</button></div></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail, updatePassword, setPersistence, browserSessionPersistence } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, updateDoc, doc, setDoc, getDoc, deleteDoc, where } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // CONFIG
        const firebaseConfig = {
          apiKey: "AIzaSyDZhPdplfEEPJAN_tvte37k9sXALutykUs",
          authDomain: "gurueletrica-5f494.firebaseapp.com",
          projectId: "gurueletrica-5f494",
          storageBucket: "gurueletrica-5f494.firebasestorage.app",
          messagingSenderId: "561793673334",
          appId: "1:561793673334:web:a68a9a603ae08875c59757"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app); 
        
        let GLOBAL_CHAVE_PIX = "ggustavo0011@gmail.com"; 
        const GURU_EMAIL = "ggustavo0011@gmail.com"; 
        const GURU_ZAP = "5583981023942"; 
        let usuarioAtual = null; 
        let filtroAtual = 'aberto'; 
        const telas = { login: document.getElementById('tela-acesso'), dash: document.getElementById('tela-dashboard') };
        
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                let dadosUser = {};
                try { const docSnap = await getDoc(doc(db, "usuarios", user.uid)); if(docSnap.exists()) dadosUser = docSnap.data(); } catch(e){}
                usuarioAtual = { uid: user.uid, email: user.email, nome: dadosUser.nome||"Usu√°rio", zap: dadosUser.zap||"", curso: dadosUser.curso||"", bio: dadosUser.bio||"", role: (user.email === GURU_EMAIL) ? 'guru' : 'student' };
                iniciarSistema();
            } else {
                usuarioAtual = null; telas.dash.classList.add('oculto'); telas.login.classList.remove('oculto');
            }
        });

        // HIBRIDO ZAP/BASE64
        const LIMITE_BYTES = 750000; 
        function lerArquivo(file) {
            return new Promise((resolve) => {
                if(!file) { resolve(null); return; }
                if(file.size > LIMITE_BYTES) resolve({ tipo: 'ZAP', dados: null, nome: file.name });
                else { const r = new FileReader(); r.onload = (e) => resolve({ tipo: 'BASE64', dados: e.target.result, nome: file.name }); r.readAsDataURL(file); }
            });
        }

        document.getElementById('link-cadastro').onclick = () => { document.getElementById('box-login').classList.add('oculto'); document.getElementById('box-cadastro').classList.remove('oculto'); };
        document.getElementById('link-login').onclick = () => { document.getElementById('box-cadastro').classList.add('oculto'); document.getElementById('box-login').classList.remove('oculto'); };
        document.getElementById('formCadastro').onsubmit = async (e) => { e.preventDefault();
            const nome=document.getElementById('cad-nome').value, email=document.getElementById('cad-email').value, zap=document.getElementById('cad-zap').value, curso=document.getElementById('cad-curso').value, senha=document.getElementById('cad-pass').value;
            try { await setPersistence(auth, browserSessionPersistence); const uc = await createUserWithEmailAndPassword(auth, email, senha); await setDoc(doc(db, "usuarios", uc.user.uid), { nome, email, zap, curso, bio: "" });
            window.open(`https://wa.me/${GURU_ZAP}?text=${encodeURIComponent(`Ol√° Guru! Criei conta.\nNome: ${nome}\nCurso: ${curso}`)}`, '_blank'); alert("Conta criada!"); e.target.reset(); } catch (error) { alert("Erro: " + error.message); }
        };
        document.getElementById('formLogin').onsubmit = async (e) => { e.preventDefault(); try { await setPersistence(auth, browserSessionPersistence); await signInWithEmailAndPassword(auth, document.getElementById('login-user').value.trim(), document.getElementById('login-pass').value.trim()); } catch (error) { alert("E-mail ou senha inv√°lidos."); } };
        document.getElementById('link-esqueci').onclick = () => document.getElementById('modal-reset-senha').classList.remove('oculto');
        document.getElementById('btn-enviar-reset').onclick = async () => { try { await sendPasswordResetEmail(auth, document.getElementById('reset-email').value); alert("Enviado!"); document.getElementById('modal-reset-senha').classList.add('oculto'); } catch (error) { alert("Erro: " + error.message); } };
        document.getElementById('btn-sair').onclick = async () => { await signOut(auth); location.reload(); };

        function iniciarSistema() {
            telas.login.classList.add('oculto'); telas.dash.classList.remove('oculto');
            const isGuru = usuarioAtual.role === 'guru';
            document.getElementById('welcome-msg').innerText = `Ol√°, ${usuarioAtual.nome.split(' ')[0]}`;
            document.getElementById('nav-config-guru').classList.toggle('oculto', !isGuru);
            document.getElementById('nav-reclamacoes').classList.toggle('oculto', !isGuru);
            document.getElementById('nav-fazer-reclamacao').classList.toggle('oculto', isGuru);
            document.getElementById('btn-novo-pedido').classList.toggle('oculto', isGuru);
            document.getElementById('mini-guru-card').classList.toggle('oculto', isGuru);
            lerPedidosDoFirebase(); carregarPerfilPublicoGuru(); 
        }

        const views = { pedidos: document.getElementById('view-pedidos'), perfilAluno: document.getElementById('view-perfil-aluno'), perfilGuruEdit: document.getElementById('view-perfil-guru-edit'), configGuru: document.getElementById('view-config-guru'), reclamacoes: document.getElementById('view-reclamacoes') };
        function switchView(name) { Object.values(views).forEach(v => v.classList.add('oculto')); views[name].classList.remove('oculto'); }
        document.getElementById('nav-pedidos').onclick = () => switchView('pedidos');
        document.getElementById('nav-perfil').onclick = () => { if(usuarioAtual.role === 'guru') switchView('perfilGuruEdit'); else { switchView('perfilAluno'); document.getElementById('perf-nome').value=usuarioAtual.nome; document.getElementById('perf-zap').value=usuarioAtual.zap; document.getElementById('perf-curso').value=usuarioAtual.curso||""; document.getElementById('perf-bio').value=usuarioAtual.bio||""; } };
        document.getElementById('nav-config-guru').onclick = () => { switchView('configGuru'); document.getElementById('conf-pix').value = GLOBAL_CHAVE_PIX; };
        document.getElementById('nav-reclamacoes').onclick = () => { switchView('reclamacoes'); lerReclamacoes(); };
        document.getElementById('nav-fazer-reclamacao').onclick = () => document.getElementById('modal-reclamacao').classList.remove('oculto');
        document.getElementById('nav-ajuda').onclick = () => document.getElementById('modal-ajuda').classList.remove('oculto');
        document.querySelectorAll('.tab-link').forEach(btn => btn.onclick = () => { document.querySelectorAll('.tab-link').forEach(b => b.classList.remove('active')); btn.classList.add('active'); filtroAtual = btn.getAttribute('data-tab'); lerPedidosDoFirebase(); });

        function lerPedidosDoFirebase() {
            onSnapshot(query(collection(db, "pedidos"), orderBy("data", "desc")), (snapshot) => {
                const lista = document.getElementById('lista-pedidos'); lista.innerHTML = "";
                let cT=0, cA=0, cC=0;
                snapshot.forEach((docSnap) => {
                    const p = docSnap.data(); const pid = docSnap.id;
                    if(usuarioAtual.role === 'student' && p.emailAluno !== usuarioAtual.email) return;
                    
                    cT++;
                    if(['Em An√°lise','Proposta Recebida','Contraproposta'].includes(p.status)) cA++;
                    if(['Finalizado','Avaliado'].includes(p.status)) cC++;

                    let mostrar = false;
                    if(filtroAtual==='aberto' && ['Em An√°lise', 'Proposta Recebida', 'Contraproposta', 'Pagamento Recusado'].includes(p.status)) mostrar=true;
                    if(filtroAtual==='andamento' && ['Pago', 'Verificando Pagamento'].includes(p.status)) mostrar=true;
                    if(filtroAtual==='finalizado' && ['Finalizado', 'Avaliado'].includes(p.status)) mostrar=true;
                    if(!mostrar) return;

                    const div = document.createElement('div'); div.className = 'request-card';
                    let stColor='var(--status-analise)';
                    if(p.status.includes('Proposta')) stColor='var(--status-proposta)';
                    if(p.status.includes('Contra')) stColor='var(--status-contra)';
                    if(p.status.includes('Verificando')) stColor='var(--status-verif)';
                    if(p.status.includes('Recusado')) stColor='var(--danger)';
                    if(p.status==='Pago') stColor='var(--status-pago)';
                    if(p.status==='Finalizado'||p.status==='Avaliado') stColor='var(--status-final)';

                    let anexoHTML = '';
                    if(p.arquivo && p.arquivo.startsWith('data:')) anexoHTML = `<a href="${p.arquivo}" download="${p.nomeArquivo}" style="color:var(--primary); font-size:12px; text-decoration:none;">üìé Baixar Anexo</a>`;
                    else if (p.arquivo === "Enviado via WhatsApp") anexoHTML = `<span style="color:var(--status-pago); font-size:12px;">üì≤ Arquivo enviado via WhatsApp</span>`;

                    let html = `${usuarioAtual.role==='guru' ? `<button class="btn-delete-req" onclick="deletarPedido('${pid}')">√ó</button>` : ''}
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            <span style="font-size:12px; color:var(--text-muted);">${p.materia}</span>
                            <span class="req-status" style="background:${stColor}20; color:${stColor};">${p.status}</span>
                        </div>
                        <h3 style="font-size:16px; margin-bottom:5px;">${p.titulo}</h3>
                        <p style="font-size:13px; color:#ccc; flex:1;">${p.desc}</p>
                        <div style="margin:10px 0;">${anexoHTML}</div>
                        <div style="border-top:1px solid #333; margin-top:10px; padding-top:10px;">`;

                    // L√ìGICA DE EXIBI√á√ÉO DA PROPOSTA (CORRIGIDA)
                    if(p.proposta) {
                        html += `<div style="font-weight:bold; color:var(--status-pago); margin-bottom:5px;">R$ ${p.proposta.valor}</div><div style="font-size:12px; color:#888; font-style:italic; margin-bottom:10px;">"${p.proposta.msg}"</div>`;
                        
                        if(usuarioAtual.role === 'student') {
                            // SE TIVER PROPOSTA, MOSTRA OS BOT√ïES (independente se o status exato bate ou n√£o, para evitar sumi√ßo)
                            if(p.status !== 'Pago' && p.status !== 'Verificando Pagamento' && p.status !== 'Finalizado' && p.status !== 'Avaliado') {
                                if(p.status === 'Pagamento Recusado') html += `<div style="color:var(--danger); font-size:11px; margin-bottom:5px;">Pagamento n√£o identificado. Tente novamente.</div>`;
                                html += `<div style="display:flex; gap:5px;"><button onclick="window.abrirModalPagamento('${pid}', '${p.proposta.valor}')" class="btn-primary" style="flex:1; font-size:12px;">Pagar</button><button onclick="window.abrirModalContra('${pid}')" class="btn-secondary" style="flex:1; font-size:12px;">Contraproposta</button></div>`;
                            } else if (p.status === 'Verificando Pagamento') { 
                                html += `<small style="color:var(--status-verif);">Aguardando aprova√ß√£o do Guru.</small>`; 
                            }
                        } else if (usuarioAtual.role === 'guru') {
                            if(p.status === 'Contraproposta') {
                                html += `<div style="background:#2a1a2a; padding:10px; border-radius:6px; margin-top:5px;"><div style="font-size:12px; color:var(--status-contra);">Oferta Aluno: <b>R$ ${p.contraproposta.valor}</b></div><div style="display:flex; gap:5px; margin-top:5px;"><button onclick="aceitarContraproposta('${pid}', '${p.contraproposta.valor}')" class="btn-primary" style="flex:1; font-size:11px;">Aceitar</button><button onclick="abrirModalProposta('${pid}', {zapAluno:'${p.zapAluno}', titulo:'${p.titulo}'})" class="btn-secondary" style="flex:1; font-size:11px;">Mudar Valor</button></div></div>`;
                            } else if (p.status === 'Verificando Pagamento') {
                                let compHTML = (p.comprovante && p.comprovante.startsWith('data:')) ? `<a href="${p.comprovante}" download="Comprovante" class="btn-secondary" style="display:block; text-align:center; font-size:12px; margin-bottom:5px; text-decoration:none;">üìÑ Ver Comprovante</a>` : `<span style="display:block; font-size:12px; color:var(--status-pago); text-align:center; margin-bottom:5px;">Comprovante no WhatsApp</span>`;
                                html += `${compHTML}<div style="display:flex; gap:5px;"><button onclick="aprovarPagamento('${pid}')" class="btn-primary" style="flex:1; background:var(--status-pago); font-size:11px;">Aprovar</button><button onclick="recusarPagamento('${pid}')" class="btn-primary" style="flex:1; background:var(--danger); font-size:11px;">Recusar</button></div>`;
                            } else if (p.status === 'Pago') {
                                html += `<button onclick="abrirModalEntrega('${pid}')" class="btn-primary" style="width:100%; background:var(--status-final);">Entregar Trabalho</button>`;
                            }
                        }
                    } else if(usuarioAtual.role === 'guru') {
                        html += `<button class="btn-primary" onclick='abrirModalProposta("${pid}", ${JSON.stringify(p).replace(/'/g, "")})' style="width:100%;">Fazer Proposta</button>`;
                    } else {
                        html += `<small style="color:#666;">Aguardando Guru...</small>`;
                    }
                    
                    if(p.status==='Finalizado'||p.status==='Avaliado') {
                        let resHTML = (p.arquivoResolucao && p.arquivoResolucao.startsWith('data:')) ? `<a href="${p.arquivoResolucao}" download="Resolucao" class="btn-primary" style="display:block; text-align:center; text-decoration:none; margin-bottom:5px;">üì• Baixar Resolu√ß√£o</a>` : `<a href="https://wa.me/${GURU_ZAP}" target="_blank" class="btn-primary" style="display:block; text-align:center; text-decoration:none; margin-bottom:5px;">üì• Resolu√ß√£o no WhatsApp</a>`;
                        html += resHTML;
                        if(usuarioAtual.role==='student' && p.status!=='Avaliado') html += `<button onclick="window.avaliarGuru('${pid}')" class="btn-secondary" style="width:100%;">Avaliar</button>`;
                        if(p.status==='Avaliado') { const s="‚òÖ".repeat(p.avaliacao?.nota||0)+"‚òÜ".repeat(5-(p.avaliacao?.nota||0)); html += `<div style="background:rgba(255,235,59,0.1); border:1px solid #ffeb3b; padding:10px; border-radius:8px; margin-top:10px;"><div style="color:#ffeb3b; font-size:14px; font-weight:bold;">${s}</div><p style="color:#e0e0e0; font-size:13px; font-style:italic;">"${p.avaliacao?.msg}"</p></div>`; }
                    }

                    div.innerHTML = html + `</div>`; lista.appendChild(div);
                });
                document.getElementById('stat-total').innerText = cT; document.getElementById('stat-aberto').innerText = cA; document.getElementById('stat-concluido').innerText = cC;
                if(lista.children.length===0) lista.innerHTML='<div style="grid-column:1/-1; text-align:center; color:#555; padding:40px;">Nenhum pedido.</div>';
            });
        }

        const setupFI = (id, dId, wId, bId) => document.getElementById(id).addEventListener('change', function(e) { if(this.files[0]) { document.getElementById(dId).innerText=this.files[0].name; if(wId) document.getElementById(wId).style.display = (this.files[0].size > LIMITE_BYTES) ? 'block' : 'none'; if(bId) document.getElementById(bId).disabled=false; }});
        setupFI('ped-file','file-name-display','file-warning-display',null); setupFI('pay-file','pay-file-display','pay-warning-display','btn-confirmar-pag'); setupFI('entrega-file','entrega-file-display','entrega-warning-display','btn-confirmar-entrega'); setupFI('upload-foto','preview-avatar',null,null); setupFI('upload-pdf-curriculo','display-pdf-name',null,null);

        document.getElementById('btn-novo-pedido').onclick = () => document.getElementById('modal-pedido').classList.remove('oculto');
        document.getElementById('formPedido').onsubmit = async (e) => { e.preventDefault();
            const t=document.getElementById('ped-titulo').value, m=document.getElementById('ped-materia').value, f=document.getElementById('ped-file').files[0];
            try { const fd = await lerArquivo(f); 
            await addDoc(collection(db, "pedidos"), { aluno: usuarioAtual.nome, emailAluno: usuarioAtual.email, zapAluno: usuarioAtual.zap, materia: m, titulo: t, desc: document.getElementById('ped-desc').value, arquivo: fd?.dados||(fd?.tipo==='ZAP'?"Enviado via WhatsApp":null), nomeArquivo: fd?.nome||null, data: Date.now(), status: 'Em An√°lise', proposta: null });
            document.querySelector('#modal-pedido .btn-close-modal').click(); e.target.reset(); document.getElementById('file-name-display').innerText="Nenhum arquivo"; document.getElementById('file-warning-display').style.display='none';
            if(fd?.tipo==='ZAP') { window.open(`https://wa.me/${GURU_ZAP}?text=${encodeURIComponent(`Ol√°! Abri pedido "${t}". Arquivo grande, enviando aqui.`)}`, '_blank'); alert("Arquivo grande. Redirecionando para WhatsApp."); } else alert("Enviado!");
            } catch(er){ alert("Erro: "+er.message); }
        };

        let pedidoEmEdicao = null; let idPedidoEmEdicao = null;
        window.abrirModalProposta = (id, dados) => { idPedidoEmEdicao = id; pedidoEmEdicao = dados; document.getElementById('modal-proposta').classList.remove('oculto'); };
        document.getElementById('formProposta').onsubmit = async (e) => { e.preventDefault(); const v=document.getElementById('prop-valor').value, m=document.getElementById('prop-msg').value; await updateDoc(doc(db, "pedidos", idPedidoEmEdicao), { status: "Proposta Recebida", proposta: { valor: v, msg: m } }); const zl=pedidoEmEdicao.zapAluno?pedidoEmEdicao.zapAluno.replace(/\D/g,""):""; if(zl) window.open(`https://wa.me/55${zl}?text=${encodeURIComponent(`Proposta para ${pedidoEmEdicao.titulo}: R$ ${v}`)}`,'_blank'); document.getElementById('modal-proposta').classList.add('oculto'); };

        let idPedidoContra=null; window.abrirModalContra=(id)=>{ idPedidoContra=id; document.getElementById('modal-contraproposta').classList.remove('oculto'); };
        document.getElementById('formContra').onsubmit=async(e)=>{ e.preventDefault(); await updateDoc(doc(db,"pedidos",idPedidoContra),{ status:"Contraproposta", contraproposta:{ valor:document.getElementById('contra-valor').value, msg:document.getElementById('contra-msg').value }}); alert("Enviado!"); document.getElementById('modal-contraproposta').classList.add('oculto'); };
        window.aceitarContraproposta=async(id,nv)=>{ if(confirm(`Aceitar R$ ${nv}?`)) await updateDoc(doc(db,"pedidos",id),{ status:"Proposta Recebida", "proposta.valor":nv }); };

        let idPedidoPagamento=null; window.abrirModalPagamento=(id,v)=>{ idPedidoPagamento=id; document.getElementById('modal-pagamento').classList.remove('oculto'); document.getElementById('display-valor-pix').innerText=`R$ ${v}`; document.getElementById('display-chave-pix').innerText=GLOBAL_CHAVE_PIX; };
        document.getElementById('btn-copiar').onclick=()=>navigator.clipboard.writeText(GLOBAL_CHAVE_PIX).then(()=>alert("Copiado!"));
        document.getElementById('btn-confirmar-pag').onclick=async()=>{ if(!idPedidoPagamento)return; const btn=document.getElementById('btn-confirmar-pag'); btn.disabled=true; try{ const f=document.getElementById('pay-file').files[0]; const fd=await lerArquivo(f); await updateDoc(doc(db,"pedidos",idPedidoPagamento),{ status:"Verificando Pagamento", comprovante: fd?.dados||(fd?.tipo==='ZAP'?"Enviado via WhatsApp":null) }); document.getElementById('modal-pagamento').classList.add('oculto'); document.getElementById('pay-file').value=""; document.getElementById('pay-warning-display').style.display='none'; if(fd?.tipo==='ZAP'){ window.open(`https://wa.me/${GURU_ZAP}?text=${encodeURIComponent(`Pagamento pedido ...${idPedidoPagamento.slice(-4)}. Comprovante aqui.`)}`,'_blank'); alert("Redirecionando para WhatsApp (Arquivo grande)."); } else alert("Enviado!"); } catch(e){alert("Erro: "+e.message);} finally{btn.disabled=false;} };
        window.aprovarPagamento=async(id)=>{ if(confirm("Confirmar?")) await updateDoc(doc(db,"pedidos",id),{ status:"Pago" }); }; window.recusarPagamento=async(id)=>{ if(confirm("Recusar?")) await updateDoc(doc(db,"pedidos",id),{ status:"Pagamento Recusado" }); };

        let idPedidoEntrega=null; window.abrirModalEntrega=(id)=>{ idPedidoEntrega=id; document.getElementById('modal-entrega').classList.remove('oculto'); };
        document.getElementById('btn-confirmar-entrega').onclick=async()=>{ const btn=document.getElementById('btn-confirmar-entrega'); btn.disabled=true; try{ const f=document.getElementById('entrega-file').files[0]; const fd=await lerArquivo(f); await updateDoc(doc(db,"pedidos",idPedidoEntrega),{ status:"Finalizado", arquivoResolucao: fd?.dados||(fd?.tipo==='ZAP'?"Enviado via WhatsApp":null) }); document.getElementById('modal-entrega').classList.add('oculto'); document.getElementById('entrega-file').value=""; document.getElementById('entrega-warning-display').style.display='none'; if(fd?.tipo==='ZAP') alert("Avise o aluno no WhatsApp (Arquivo grande)."); else alert("Entregue!"); } catch(e){alert("Erro: "+e.message);} finally{btn.disabled=false;} };

        let idAval=null; let nota=5; window.avaliarGuru=(id)=>{ idAval=id; document.getElementById('modal-avaliacao').classList.remove('oculto'); };
        document.querySelectorAll('.star').forEach(s=>s.onclick=function(){ nota=this.getAttribute('data-val'); document.querySelectorAll('.star').forEach(st=>st.classList.toggle('selected', st.getAttribute('data-val')<=nota)); });
        document.getElementById('btn-enviar-aval').onclick=async()=>{ await updateDoc(doc(db,"pedidos",idAval),{ status:"Avaliado", avaliacao:{ nota:nota, msg:document.getElementById('aval-msg').value }}); alert("Avaliado!"); document.getElementById('modal-avaliacao').classList.add('oculto'); };
        document.getElementById('formReclamacao').onsubmit=async(e)=>{ e.preventDefault(); await addDoc(collection(db,"reclamacoes"),{ aluno:usuarioAtual.nome, email:usuarioAtual.email, zap:usuarioAtual.zap, titulo:document.getElementById('rec-titulo').value, msg:document.getElementById('rec-msg').value, data:Date.now() }); alert("Registrado."); document.getElementById('modal-reclamacao').classList.add('oculto'); };
        function lerReclamacoes(){ onSnapshot(query(collection(db,"reclamacoes"), orderBy("data","desc")), (snap)=>{ const l=document.getElementById('lista-reclamacoes-admin'); l.innerHTML=""; snap.forEach(d=>{ const r=d.data(); l.innerHTML+=`<div class="request-card"><button class="btn-delete-req" onclick="excluirReclamacao('${d.id}')">‚úÖ</button><div style="font-weight:bold; color:var(--danger);">${r.titulo}</div><div style="font-size:12px; color:#aaa;">${r.aluno} (${r.zap})</div><div style="color:#ddd;">"${r.msg}"</div></div>`; }); if(!l.children.length)l.innerHTML='<div style="padding:20px;text-align:center;">Sem reclama√ß√µes.</div>'; }); }
        window.excluirReclamacao=async(id)=>{ if(confirm("Resolver?")) await deleteDoc(doc(db,"reclamacoes",id)); };
        document.getElementById('formPerfilAluno').onsubmit=async(e)=>{ e.preventDefault(); await updateDoc(doc(db,"usuarios",usuarioAtual.uid),{ nome:document.getElementById('perf-nome').value, zap:document.getElementById('perf-zap').value, curso:document.getElementById('perf-curso').value, bio:document.getElementById('perf-bio').value }); alert("Salvo!"); document.getElementById('nav-pedidos').click(); };
        document.getElementById('formPerfilGuruEdit').onsubmit=async(e)=>{ e.preventDefault(); const btn=document.getElementById('btn-save-perf-guru'); btn.disabled=true; try{ const ff=document.getElementById('upload-foto').files[0], fp=document.getElementById('upload-pdf-curriculo').files[0]; let bf=document.getElementById('conf-img-base64').value, bp=document.getElementById('conf-pdf-base64').value; if(ff){ if(ff.size>750000)throw new Error("Foto > 750KB"); const r=await lerArquivo(ff); bf=r.dados; } if(fp){ if(fp.size>750000)throw new Error("PDF > 750KB"); const r=await lerArquivo(fp); bp=r.dados; } await setDoc(doc(db,"config_site","perfil_guru"),{ titulo:document.getElementById('conf-titulo').value, sub:document.getElementById('conf-sub').value, bio:document.getElementById('conf-bio').value, imgBase64:bf, pdfBase64:bp, lattes:document.getElementById('conf-lattes').value }, {merge:true}); alert("Atualizado!"); carregarPerfilPublicoGuru(); document.getElementById('nav-pedidos').click(); }catch(e){alert("Erro: "+e.message);} finally{btn.disabled=false;} };
        document.getElementById('formConfigGuru').onsubmit=async(e)=>{ e.preventDefault(); const np=document.getElementById('conf-pix').value, ns=document.getElementById('conf-nova-senha').value; if(np) await setDoc(doc(db,"config_site","perfil_guru"),{pix:np},{merge:true}); if(ns){ if(ns.length<6){alert("Min 6 chars");return;} try{await updatePassword(auth.currentUser,ns);alert("Senha alterada!");}catch(e){alert(e.message);return;} } alert("Salvo!"); carregarPerfilPublicoGuru(); document.getElementById('nav-pedidos').click(); };
        async function carregarPerfilPublicoGuru(){ const d=await getDoc(doc(db,"config_site","perfil_guru")); if(d.exists()){ const dd=d.data(); if(dd.pix) GLOBAL_CHAVE_PIX=dd.pix; const im=dd.imgBase64||""; if(document.getElementById('guru-avatar-img'))document.getElementById('guru-avatar-img').style.backgroundImage=`url('${im}')`; if(document.getElementById('header-guru-img'))document.getElementById('header-guru-img').style.backgroundImage=`url('${im}')`; if(document.getElementById('guru-title'))document.getElementById('guru-title').innerText=dd.titulo; if(document.getElementById('guru-subtitle'))document.getElementById('guru-subtitle').innerText=dd.sub; if(usuarioAtual&&usuarioAtual.role==='guru'){ document.getElementById('preview-avatar').style.backgroundImage=`url('${im}')`; document.getElementById('conf-img-base64').value=im; document.getElementById('conf-pdf-base64').value=dd.pdfBase64||""; document.getElementById('conf-bio').value=dd.bio; document.getElementById('conf-titulo').value=dd.titulo; document.getElementById('conf-sub').value=dd.sub; document.getElementById('conf-lattes').value=dd.lattes||""; document.getElementById('conf-pix').value=dd.pix||""; } document.getElementById('btn-ver-quali-header').onclick=document.getElementById('btn-ver-quali').onclick=async()=>{ document.getElementById('qualificacoes-texto').innerText=dd.bio||""; const bl=document.getElementById('btn-link-lattes'); if(dd.lattes){bl.href=dd.lattes; bl.style.display='block';}else bl.style.display='none'; const bp=document.getElementById('btn-link-pdf'); if(dd.pdfBase64){bp.href=dd.pdfBase64; bp.style.display='block';}else bp.style.display='none'; const la=document.getElementById('lista-avaliacoes-publicas'); la.innerHTML='...'; const q=query(collection(db,"pedidos"),where("status","==","Avaliado")); onSnapshot(q,(s)=>{ la.innerHTML=""; if(s.empty){la.innerHTML='<div style="text-align:center;color:#666;">Sem avalia√ß√µes.</div>';return;} s.forEach(d=>{ const r=d.data(); const st="‚òÖ".repeat(r.avaliacao.nota); la.innerHTML+=`<div class="review-item"><div class="review-header"><span>${r.aluno.split(' ')[0]}</span> <span class="review-stars">${st}</span></div><div style="font-size:13px; color:#ddd;">"${r.avaliacao.msg}"</div></div>`; }); }); document.getElementById('modal-qualificacoes').classList.remove('oculto'); }; } }

        window.deletarPedido=async(id)=>{ if(confirm("Excluir?")) await deleteDoc(doc(db,"pedidos",id)); };
        document.querySelectorAll('.btn-close-modal').forEach(b=>b.onclick=(e)=>{e.preventDefault();e.target.closest('.modal-overlay').classList.add('oculto');});
        const bar=document.getElementById('btn-admin-recl'); if(bar) bar.onclick=()=>{ switchView('reclamacoes'); lerReclamacoes(); };
    </script>
</body>
</html>
