<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guru da El√©trica - Plataforma Online</title>
    <style>
        /* --- RESET E BASE --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        body { background-color: #121212; color: #e0e0e0; height: 100vh; overflow: hidden; }
        .oculto { display: none !important; }
        
        /* --- CORES E VARI√ÅVEIS --- */
        :root {
            --primary: #0095f6;
            --bg-dark: #121212;
            --bg-card: #1e1e1e;
            --sidebar: #000000;
            --text-main: #fff;
            --text-muted: #aaa;
            --border: #333;
            --status-analise: #2196f3;
            --status-proposta: #ff9800;
            --status-contra: #9c27b0;
            --status-verif: #e91e63;
            --status-pago: #4caf50;
            --status-final: #607d8b;
            --danger: #d32f2f;
        }

        /* =========================================
           LAYOUT 1: TELA DE LOGIN
           ========================================= */
        .split-screen { display: flex; height: 100vh; width: 100%; }
        .left-side-showcase { flex: 1; position: relative; display: flex; align-items: flex-end; padding: 60px; overflow: hidden; background-color: #000; }
        
        .slide-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center; opacity: 0; animation: imageSlide 15s infinite; z-index: 0; }
        .slide-img:nth-child(1) { background-image: url('https://images.unsplash.com/photo-1517077304055-6e89abbf09b0?q=80&w=1476&auto=format&fit=crop'); animation-delay: 0s; }
        .slide-img:nth-child(2) { background-image: url('https://images.unsplash.com/photo-1581092334651-ddf26d9a09d0?q=80&w=1470&auto=format&fit=crop'); animation-delay: 5s; }
        .slide-img:nth-child(3) { background-image: url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=1472&auto=format&fit=crop'); animation-delay: 10s; }
        
        @keyframes imageSlide { 
            0% { opacity: 0; transform: scale(1); } 
            10% { opacity: 1; transform: scale(1.05); } 
            33% { opacity: 1; transform: scale(1.1); } 
            43% { opacity: 0; transform: scale(1); } 
            100% { opacity: 0; } 
        }

        .overlay-dark { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.3)); z-index: 1; }
        .showcase-content { position: relative; z-index: 2; max-width: 500px; text-shadow: 2px 2px 10px rgba(0,0,0,0.8); }
        .showcase-content h1 { font-size: 44px; margin-bottom: 15px; color: #fff; font-weight: 800; line-height: 1.1; }
        
        .auth-container { flex: 1; background-color: #121212; z-index: 3; display: flex; flex-direction: column; justify-content: center; align-items: center; border-left: 1px solid #222; }
        .container-auth { width: 400px; max-width: 90%; padding: 40px; }
        .box { background-color: var(--bg-card); border: 1px solid var(--border); padding: 40px; border-radius: 12px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        /* =========================================
           LAYOUT 2: DASHBOARD INTERNO
           ========================================= */
        .app-layout { display: flex; height: 100vh; width: 100%; background: var(--bg-dark); }
        
        .sidebar { width: 260px; background: var(--sidebar); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; }
        .sidebar-logo { font-size: 24px; font-weight: bold; color: #fff; margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
        .sidebar-logo span { color: var(--primary); }
        
        .nav-menu { flex: 1; display: flex; flex-direction: column; gap: 10px; }
        .nav-item { padding: 12px 15px; border-radius: 8px; color: var(--text-muted); cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 10px; font-weight: 500; border: none; background: transparent; text-align: left; width: 100%; font-size: 14px; }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.1); color: #fff; }
        .nav-item.danger { color: var(--danger); margin-top: auto; }
        .nav-item.danger:hover { background: rgba(211, 47, 47, 0.1); }

        .main-content { flex: 1; overflow-y: auto; padding: 30px; position: relative; }
        .main-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .user-welcome h2 { font-size: 24px; color: #fff; }
        .user-welcome p { color: var(--text-muted); font-size: 14px; }
        
        /* NOVO CSS PARA O CARD DO GURU */
        .guru-hero-card {
            background: linear-gradient(135deg, #1e1e1e, #252525);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .requests-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; }
        .request-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; display: flex; flex-direction: column; gap: 10px; transition: transform 0.2s; position: relative; }
        .request-card:hover { transform: translateY(-2px); border-color: #555; }
        
        .logo { font-size: 32px; margin-bottom: 30px; font-family: 'Segoe UI', sans-serif; color: #fff; font-weight: bold; }
        .logo span { color: #0095f6; }
        input, select, textarea { width: 100%; padding: 12px; margin-bottom: 12px; background-color: #262626; border: 1px solid #444; color: #fff; border-radius: 6px; font-size: 14px; }
        button.btn-primary { width: 100%; padding: 12px; background-color: var(--primary); border: none; color: #fff; font-weight: bold; border-radius: 6px; cursor: pointer; font-size: 14px; transition: 0.2s; }
        button.btn-primary:hover { opacity: 0.9; }
        button:disabled { background-color: #333 !important; color: #666 !important; cursor: not-allowed; }
        button.btn-danger { background-color: var(--danger); color: #fff; }
        button.btn-secondary { background: transparent; border: 1px solid #555; color: #ccc; margin-top: 5px; }
        
        .tabs-header { display: flex; gap: 20px; border-bottom: 1px solid var(--border); margin-bottom: 20px; }
        .tab-link { padding: 10px 0; background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 14px; position: relative; }
        .tab-link.active { color: var(--primary); font-weight: bold; }
        .tab-link.active::after { content: ''; position: absolute; bottom: -1px; left: 0; width: 100%; height: 2px; background: var(--primary); }

        .req-status { padding: 4px 10px; border-radius: 20px; font-weight: bold; font-size: 11px; text-transform: uppercase; align-self: flex-start; }
        .btn-delete-req { position: absolute; top: 15px; right: 15px; background: transparent; border: none; color: var(--danger); cursor: pointer; font-size: 18px; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); z-index: 200; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-box { background-color: var(--bg-card); width: 600px; max-width: 95%; border-radius: 12px; border: 1px solid var(--border); padding: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); max-height: 90vh; overflow-y: auto; }
        
        .custom-file-upload { display: block; padding: 15px; cursor: pointer; background: #262626; color: #ccc; border-radius: 8px; border: 1px dashed #555; text-align: center; transition: 0.2s; margin-top: 10px; }
        .custom-file-upload:hover { border-color: var(--primary); color: #fff; background: #2a2a2a; }
        input[type="file"] { display: none; }

        .pix-display-key { background: #fff; color: #000; padding: 15px; border-radius: 8px; font-weight: bold; font-size: 16px; text-align: center; word-break: break-all; margin: 15px 0; border: 2px dashed var(--status-pago); }

        .profile-large-img { width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 20px; background-size: cover; background-position: center; border: 3px solid var(--primary); background-color: #333; }
        .rating-stars { display: flex; justify-content: center; gap: 5px; margin-bottom: 10px; }
        .star { font-size: 30px; cursor: pointer; color: #444; }
        .star.selected { color: #ffeb3b; }

        /* AVALIA√á√ïES NO MODAL DO GURU */
        .review-item { background: #181818; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 3px solid var(--primary); }
        .review-header { display: flex; justify-content: space-between; font-size: 12px; color: #aaa; margin-bottom: 5px; }
        .review-stars { color: #ffeb3b; font-size: 14px; }

        @media (max-width: 900px) { 
            .left-side-showcase { display: none; } 
            .auth-container { border-left: none; }
            .app-layout { flex-direction: column; }
            .sidebar { width: 100%; height: auto; flex-direction: row; padding: 10px; overflow-x: auto; border-bottom: 1px solid var(--border); border-right: none; align-items: center; }
            .sidebar-logo { margin-bottom: 0; margin-right: 20px; font-size: 20px; }
            .nav-menu { flex-direction: row; }
            .nav-item { padding: 8px 12px; white-space: nowrap; }
            .requests-grid { grid-template-columns: 1fr; }
            .guru-hero-card { flex-direction: column; text-align: center; }
        }
    </style>
</head>
<body>

    <div id="tela-acesso" class="split-screen">
        <div class="left-side-showcase">
            <div class="slide-img"></div><div class="slide-img"></div><div class="slide-img"></div><div class="overlay-dark"></div>
            <div class="showcase-content"><h1>Seu Guru de Engenharia.</h1><p>Receba ajuda personalizada agora.</p></div>
        </div>
        <div class="auth-container">
            <div id="box-login" class="container-auth">
                <div class="box">
                    <h1 class="logo">Guru<span>El√©trica</span></h1>
                    <form id="formLogin">
                        <input type="text" id="login-user" placeholder="Email" required>
                        <input type="password" id="login-pass" placeholder="Senha" required>
                        <button type="submit" class="btn-primary">Entrar na Plataforma</button>
                    </form>
                    <div style="margin-top:15px; font-size:13px; color:#aaa;">
                        <a href="#" id="link-esqueci" style="color:#aaa; text-decoration: underline;">Esqueci minha senha</a>
                        <br><br>
                        N√£o tem conta? <a href="#" id="link-cadastro" style="color:var(--primary);">Cadastre-se</a>
                    </div>
                </div>
            </div>
            <div id="box-cadastro" class="container-auth oculto">
                <div class="box">
                    <h1 class="logo">Criar Conta</h1>
                    <form id="formCadastro">
                        <input type="text" id="cad-nome" placeholder="Nome completo" required>
                        <div class="form-row" style="display:flex; gap:10px;">
                            <input type="email" id="cad-email" placeholder="Email" style="flex:2" required>
                            <input type="tel" id="cad-zap" placeholder="WhatsApp (DDD+Num)" style="flex:1" required>
                        </div>
                        <input type="text" id="cad-curso" placeholder="Curso" required>
                        <input type="password" id="cad-pass" placeholder="Senha" required>
                        <button type="submit" class="btn-primary">Cadastrar</button>
                    </form>
                    <p style="margin-top:15px; font-size:13px; color:#aaa;">J√° tem conta? <a href="#" id="link-login" style="color:var(--primary);">Voltar</a></p>
                </div>
            </div>
        </div>
    </div>

    <div id="tela-dashboard" class="app-layout oculto">
        <aside class="sidebar">
            <div class="sidebar-logo">‚ö° Guru<span>El√©trica</span></div>
            <nav class="nav-menu">
                <button class="nav-item active" id="nav-pedidos">üìù Meus Pedidos</button>
                <button class="nav-item" id="nav-perfil">üë§ Meu Perfil</button>
                <button class="nav-item oculto" id="nav-config-guru">‚öôÔ∏è Config Guru</button>
                <button class="nav-item oculto" id="nav-reclamacoes">üì¢ Reclama√ß√µes</button>
                <button class="nav-item" id="nav-fazer-reclamacao">üì¢ Reclamar</button>
                <button class="nav-item" id="nav-ajuda">‚ùì Ajuda</button>
                <button class="nav-item danger" id="btn-sair">üö™ Sair</button>
            </nav>
        </aside>

        <main class="main-content">
            <div class="main-header">
                <div class="user-welcome"><h2 id="welcome-msg">Bem-vindo!</h2><p id="welcome-sub">Painel de Controle</p></div>
                <div id="mini-guru-card" style="display:flex; align-items:center; gap:10px; background:var(--bg-card); padding:8px 15px; border-radius:30px; border:1px solid var(--border);">
                    <div id="header-guru-img" style="width:30px; height:30px; border-radius:50%; background:#333; background-size:cover;"></div>
                    <span style="font-size:12px; font-weight:bold;">Guru Online</span>
                    <button id="btn-ver-quali-header" style="background:none; border:none; color:var(--primary); font-size:11px; cursor:pointer;">Ver Qualifica√ß√µes</button>
                </div>
            </div>

            <div id="guru-hero-card" class="guru-hero-card">
                <div id="guru-avatar-img" style="width: 80px; height: 80px; border-radius: 50%; background-color: #333; background-size: cover; background-position: center; border: 2px solid var(--primary); flex-shrink: 0;"></div>
                <div>
                    <h2 id="guru-title" style="margin-bottom: 5px; font-size: 20px; color: #fff;">Guru da El√©trica</h2>
                    <p id="guru-subtitle" style="color: #aaa; margin-bottom: 10px; font-size: 14px;">Especialista em Circuitos e Projetos</p>
                    <button id="btn-ver-quali" style="background: none; border: 1px solid var(--primary); color: var(--primary); padding: 5px 15px; border-radius: 4px; cursor: pointer; font-size: 12px; transition: 0.2s;">Ver Qualifica√ß√µes Completas</button>
                </div>
            </div>
            <div id="view-pedidos">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <div class="tabs-header" style="margin-bottom:0; border:none;">
                        <button class="tab-link active" data-tab="aberto">Em Aberto</button>
                        <button class="tab-link" data-tab="andamento">Em Andamento</button>
                        <button class="tab-link" data-tab="finalizado">Finalizados</button>
                    </div>
                    <button class="btn-primary" id="btn-novo-pedido" style="width:auto;">+ Novo Pedido</button>
                </div>
                <div style="display:flex; gap:10px; margin-bottom:20px; font-size:12px; color:#777;">
                    <span>Total: <b id="stat-total" style="color:#fff;">0</b></span> |
                    <span>Abertos: <b id="stat-aberto" style="color:var(--status-analise);">0</b></span> |
                    <span>Conclu√≠dos: <b id="stat-concluido" style="color:var(--status-final);">0</b></span>
                </div>
                <div id="lista-pedidos" class="requests-grid"></div>
            </div>

            <div id="view-perfil-aluno" class="profile-section oculto">
                <div class="profile-large-img" style="background-image:none; display:flex; align-items:center; justify-content:center; font-size:40px;">üë§</div>
                <h2 style="text-align:center; margin-bottom:30px;">Editar Perfil</h2>
                <form id="formPerfilAluno">
                    <label>Seu Nome</label><input type="text" id="perf-nome">
                    <label>WhatsApp</label><input type="text" id="perf-zap">
                    <label>Curso</label><input type="text" id="perf-curso">
                    <label>Bio</label><textarea id="perf-bio"></textarea>
                    <button type="submit" class="btn-primary">Salvar Altera√ß√µes</button>
                </form>
            </div>

            <div id="view-config-guru" class="profile-section oculto">
                <div id="preview-avatar" class="profile-large-img"></div>
                <div style="text-align:center; margin-bottom:20px;">
                    <label for="upload-foto" style="cursor:pointer; color:var(--primary);">Alterar Foto</label>
                    <input id="upload-foto" type="file" accept="image/*">
                </div>
                <form id="formConfigGuru">
                    <input type="hidden" id="conf-img-base64">
                    <input type="hidden" id="conf-pdf-base64"> <label>T√≠tulo</label><input type="text" id="conf-titulo">
                    <label>Subt√≠tulo</label><input type="text" id="conf-sub">
                    <label>Sobre Mim</label><textarea id="conf-bio"></textarea>
                    
                    <label style="color:#2196f3;">Link Curr√≠culo Lattes</label>
                    <input type="url" id="conf-lattes" placeholder="http://lattes.cnpq.br/...">
                    
                    <label style="color:#2196f3;">Upload Curr√≠culo PDF</label>
                    <label for="upload-pdf-curriculo" class="custom-file-upload">üìé Selecionar PDF</label>
                    <input type="file" id="upload-pdf-curriculo" accept=".pdf">
                    <div id="display-pdf-name" style="font-size:12px; color:#888; text-align:center; margin-bottom:15px;">Nenhum arquivo</div>

                    <label style="color:var(--status-pago);">Chave PIX (Para Recebimento)</label>
                    <input type="text" id="conf-pix" style="border-color:var(--status-pago);">

                    <label style="color:var(--status-verif);">Alterar Senha Admin</label><input type="password" id="conf-senha" placeholder="Nova senha">
                    <button type="submit" class="btn-primary btn-admin">Salvar Configura√ß√µes</button>
                </form>
            </div>

            <div id="view-reclamacoes" class="oculto">
                <h2 style="color:var(--danger); margin-bottom:20px;">Painel de Reclama√ß√µes</h2>
                <div id="lista-reclamacoes-admin" class="requests-grid"></div>
            </div>
        </main>
    </div>

    <div id="modal-qualificacoes" class="modal-overlay oculto">
        <div class="modal-box">
            <h3>Sobre o Guru</h3>
            <div id="qualificacoes-texto" style="margin-top:15px; color:#ccc; line-height:1.5; white-space: pre-wrap; margin-bottom:20px;"></div>
            
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <a id="btn-link-lattes" href="#" target="_blank" class="btn-primary" style="text-align:center; text-decoration:none; background:#333; flex:1; border:1px solid #555; display:none;">üåê Acessar Lattes</a>
                <a id="btn-link-pdf" href="#" download="Curriculo_Guru.pdf" class="btn-primary" style="text-align:center; text-decoration:none; background:#333; flex:1; border:1px solid #555; display:none;">üìÑ Baixar Curr√≠culo PDF</a>
            </div>

            <h4 style="border-top:1px solid #333; padding-top:15px; margin-bottom:15px; color:#ffeb3b;">Avalia√ß√µes dos Alunos</h4>
            <div id="lista-avaliacoes-publicas" style="max-height:200px; overflow-y:auto; padding-right:5px;">
                </div>

            <button class="btn-close-modal" style="width:100%; padding:10px; background:transparent; border:none; color:#aaa; cursor:pointer; margin-top:20px;">Fechar</button>
        </div>
    </div>

    <div id="modal-reset-senha" class="modal-overlay oculto">
        <div class="modal-box" style="width:400px; text-align:center;">
            <h3>Recuperar Senha</h3>
            <p style="font-size:13px; color:#aaa; margin-bottom:20px;">Digite seu e-mail para redefinir a senha.</p>
            <input type="email" id="reset-email" placeholder="Seu e-mail cadastrado">
            <input type="password" id="reset-nova-senha" placeholder="Nova Senha" style="display:none; margin-top:10px;">
            <button id="btn-verificar-email" class="btn-primary">Verificar E-mail</button>
            <button id="btn-salvar-nova-senha" class="btn-primary oculto" style="background:#4caf50;">Salvar Nova Senha</button>
            <button class="btn-close-modal" style="width:100%; margin-top:10px; background:transparent; border:none; color:#aaa;">Cancelar</button>
        </div>
    </div>

    <div id="modal-pedido" class="modal-overlay oculto">
        <div class="modal-box">
            <h3>Novo Pedido</h3>
            <form id="formPedido" style="margin-top:15px;">
                <input type="text" id="ped-materia" placeholder="Mat√©ria" required>
                <input type="text" id="ped-titulo" placeholder="T√≠tulo" required>
                <textarea id="ped-desc" placeholder="Descri√ß√£o..." style="height:80px;" required></textarea>
                <label for="ped-file" class="custom-file-upload">üìé Anexar Arquivo (PDF/IMG - Max 500KB)</label>
                <input type="file" id="ped-file" accept="image/*,.pdf">
                <div id="file-name-display" style="font-size:12px; color:#aaa; margin-top:5px; text-align:center;">Nenhum arquivo</div>
                <input type="hidden" id="ped-file-base64">
                <button type="submit" class="btn-primary">Enviar</button>
            </form>
            <button class="btn-close-modal" style="width:100%; padding:10px; background:transparent; border:none; color:#aaa; cursor:pointer;">Cancelar</button>
        </div>
    </div>

    <div id="modal-proposta" class="modal-overlay oculto">
        <div class="modal-box">
            <h3>Enviar Proposta</h3>
            <form id="formProposta">
                <input type="hidden" id="prop-id">
                <input type="number" id="prop-valor" placeholder="Valor (R$)" required>
                <textarea id="prop-msg" placeholder="Detalhes..." required></textarea>
                <button type="submit" class="btn-primary btn-admin">Enviar no WhatsApp</button>
            </form>
            <button class="btn-close-modal" style="width:100%; padding:10px; background:transparent; border:none; color:#aaa; cursor:pointer;">Cancelar</button>
        </div>
    </div>

    <div id="modal-contraproposta" class="modal-overlay oculto">
        <div class="modal-box">
            <h3 style="color:var(--status-contra);">Fazer Contraproposta</h3>
            <form id="formContra">
                <input type="hidden" id="contra-id">
                <input type="number" id="contra-valor" placeholder="Sua oferta (R$)" required>
                <textarea id="contra-msg" placeholder="Motivo..." required></textarea>
                <button type="submit" class="btn-primary" style="background:var(--status-contra);">Enviar Oferta</button>
            </form>
            <button class="btn-close-modal" style="width:100%; padding:10px; background:transparent; border:none; color:#aaa; cursor:pointer;">Cancelar</button>
        </div>
    </div>

    <div id="modal-pagamento" class="modal-overlay oculto">
        <div class="modal-box" style="text-align:center;">
            <h3>Realizar Pagamento</h3>
            <p style="color:#aaa; font-size:14px;">Fa√ßa um PIX para a chave abaixo:</p>
            <div id="display-valor-pix" style="font-size:24px; color:var(--status-pago); font-weight:bold; margin:10px 0;">R$ 0,00</div>
            <div class="pix-display-key"><span id="display-chave-pix">CARREGANDO...</span></div>
            <button id="btn-copiar" class="btn-primary" style="background:#333;">Copiar Chave</button>
            <div style="margin-top:20px; border-top:1px dashed #444; padding-top:15px; text-align:left;">
                <p style="font-size:12px; color:#aaa;">‚ö†Ô∏è Anexe o comprovante:</p>
                <label for="pay-file" class="custom-file-upload">üìé Enviar Comprovante</label>
                <input type="file" id="pay-file" accept="image/*,.pdf">
                <div id="pay-file-display" style="font-size:11px; color:#888; margin-top:5px; text-align:center;">Nenhum arquivo</div>
                <input type="hidden" id="pay-file-base64">
            </div>
            <button id="btn-confirmar-pag" class="btn-primary" style="background:var(--status-pago); margin-top:10px;" disabled>J√° Fiz o Pagamento</button>
            <button class="btn-close-modal" style="width:100%; padding:10px; background:transparent; border:none; color:#aaa; cursor:pointer;">Cancelar</button>
        </div>
    </div>

    <div id="modal-entrega" class="modal-overlay oculto">
        <div class="modal-box">
            <h3>Entregar Trabalho</h3>
            <label for="entrega-file" class="custom-file-upload">üìé Anexar Resolu√ß√£o (PDF, ZIP, IMG...)</label>
            <input type="file" id="entrega-file" accept=".pdf, .png, .jpg, .jpeg, .zip, .rar, image/*">
            <div id="entrega-file-display" style="font-size:11px; color:#888; margin-top:5px;">Nenhum arquivo</div>
            <input type="hidden" id="entrega-file-base64">
            <button id="btn-confirmar-entrega" class="btn-primary" style="margin-top:15px;" disabled>Finalizar e Entregar</button>
            <button class="btn-close-modal" style="width:100%; padding:10px; background:transparent; border:none; color:#aaa; cursor:pointer;">Cancelar</button>
        </div>
    </div>

    <div id="modal-reclamacao" class="modal-overlay oculto">
        <div class="modal-box">
            <h3 style="color:var(--danger);">Registrar Problema</h3>
            <form id="formReclamacao" style="margin-top:15px;">
                <input type="text" id="rec-titulo" placeholder="Assunto" required>
                <textarea id="rec-msg" placeholder="Descreva o problema..." required style="height:100px;"></textarea>
                <button type="submit" class="btn-primary btn-danger">Enviar</button>
            </form>
            <button class="btn-close-modal" style="width:100%; padding:10px; background:transparent; border:none; color:#aaa; cursor:pointer;">Cancelar</button>
        </div>
    </div>

    <div id="modal-avaliacao" class="modal-overlay oculto">
        <div class="modal-box" style="text-align:center;">
            <h3 style="color:#ffeb3b;">Avaliar Guru</h3>
            <div class="rating-stars" id="star-container">
                <span class="star" data-val="1">‚òÖ</span><span class="star" data-val="2">‚òÖ</span><span class="star" data-val="3">‚òÖ</span><span class="star" data-val="4">‚òÖ</span><span class="star" data-val="5">‚òÖ</span>
            </div>
            <textarea id="aval-msg" placeholder="Coment√°rio..." style="height:80px;"></textarea>
            <button id="btn-enviar-aval" class="btn-primary" style="margin-top:10px;">Enviar</button>
            <button class="btn-close-modal" style="width:100%; padding:10px; background:transparent; border:none; color:#aaa; cursor:pointer;">Cancelar</button>
        </div>
    </div>

    <div id="modal-ajuda" class="modal-overlay oculto">
        <div class="modal-box">
            <h3>Ajuda</h3>
            <details class="faq-item"><summary>Pagamentos?</summary><p>Via PIX manual.</p></details>
            <div class="danger-zone" style="margin-top:20px; border-top:1px solid #333; padding-top:10px;">
                <button id="btn-iniciar-exclusao" class="btn-primary btn-danger">Excluir Minha Conta</button>
            </div>
            <button class="btn-close-modal" style="width:100%; padding:10px; background:transparent; border:none; color:#aaa; cursor:pointer;">Fechar</button>
        </div>
    </div>

    <div id="modal-exclusao" class="modal-overlay oculto">
        <div class="modal-box">
            <h3 style="color:var(--danger);">Excluir Conta</h3>
            <form id="formExclusao">
                <select id="exc-motivo" required><option value="">Motivo...</option><option>Pre√ßo</option><option>Outro</option></select>
                <button type="submit" class="btn-primary btn-danger">Confirmar Exclus√£o</button>
            </form>
            <button class="btn-close-modal" style="width:100%; padding:10px; background:transparent; border:none; color:#aaa; cursor:pointer;">Cancelar</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, updateDoc, doc, setDoc, getDoc, deleteDoc, where } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyDZHpdplfEEPJAN_tvte37k9sXALutykUs", authDomain: "gurueletrica-5f494.firebaseapp.com", projectId: "gurueletrica-5f494", storageBucket: "gurueletrica-5f494.firebasestorage.app", messagingSenderId: "561793673334", appId: "1:561793673334:web:a68a9a603ae08875c59757" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        let GLOBAL_CHAVE_PIX = "ggustavo0011@gmail.com"; 
        const GURU_EMAIL = "ggustavo0011@gmail.com"; 
        if(!localStorage.getItem('guruPass')) { localStorage.setItem('guruPass', 'admin123'); }

        let usuarioAtual = null; 
        let filtroAtual = 'aberto'; 
        
        const telas = { login: document.getElementById('tela-acesso'), dash: document.getElementById('tela-dashboard') };
        
        document.getElementById('link-cadastro').onclick = () => { document.getElementById('box-login').classList.add('oculto'); document.getElementById('box-cadastro').classList.remove('oculto'); };
        document.getElementById('link-login').onclick = () => { document.getElementById('box-cadastro').classList.add('oculto'); document.getElementById('box-login').classList.remove('oculto'); };
        
        document.getElementById('formCadastro').onsubmit = (e) => {
            e.preventDefault();
            const user = { nome: document.getElementById('cad-nome').value, email: document.getElementById('cad-email').value, zap: document.getElementById('cad-zap').value, pass: document.getElementById('cad-pass').value, curso: document.getElementById('cad-curso').value, bio: "", role: 'student' };
            localStorage.setItem('guruUser_' + user.email, JSON.stringify(user));
            alert('Cadastro realizado!');
            document.getElementById('link-login').click();
        };

        document.getElementById('formLogin').onsubmit = (e) => {
            e.preventDefault();
            const email = document.getElementById('login-user').value.trim();
            const pass = document.getElementById('login-pass').value.trim();
            const adminPass = localStorage.getItem('guruPass');

            if(email === GURU_EMAIL && pass === adminPass) {
                usuarioAtual = { nome: "Gustavo Guru", email: email, role: 'guru' };
                iniciarSistema();
            } else {
                const salvo = JSON.parse(localStorage.getItem('guruUser_' + email));
                if(salvo && salvo.pass === pass) {
                    usuarioAtual = salvo;
                    iniciarSistema();
                } else {
                    alert('Dados incorretos.');
                }
            }
        };

        // --- SISTEMA DE RESET DE SENHA ---
        document.getElementById('link-esqueci').onclick = () => document.getElementById('modal-reset-senha').classList.remove('oculto');
        
        let emailParaReset = '';
        document.getElementById('btn-verificar-email').onclick = () => {
            emailParaReset = document.getElementById('reset-email').value.trim();
            if(!emailParaReset) { alert("Digite o e-mail."); return; }

            if(emailParaReset === GURU_EMAIL) {
                alert("E-mail de Admin encontrado.");
                document.getElementById('reset-nova-senha').style.display = 'block';
                document.getElementById('btn-verificar-email').classList.add('oculto');
                document.getElementById('btn-salvar-nova-senha').classList.remove('oculto');
            } 
            else if(localStorage.getItem('guruUser_' + emailParaReset)) {
                alert("Usu√°rio encontrado.");
                document.getElementById('reset-nova-senha').style.display = 'block';
                document.getElementById('btn-verificar-email').classList.add('oculto');
                document.getElementById('btn-salvar-nova-senha').classList.remove('oculto');
            } else {
                alert("E-mail n√£o encontrado no sistema.");
            }
        };

        document.getElementById('btn-salvar-nova-senha').onclick = () => {
            const novaSenha = document.getElementById('reset-nova-senha').value;
            if(!novaSenha) { alert("Digite uma nova senha."); return; }

            if(emailParaReset === GURU_EMAIL) {
                localStorage.setItem('guruPass', novaSenha);
                alert("Senha de Admin alterada com sucesso!");
            } else {
                let user = JSON.parse(localStorage.getItem('guruUser_' + emailParaReset));
                user.pass = novaSenha;
                localStorage.setItem('guruUser_' + emailParaReset, JSON.stringify(user));
                alert("Senha alterada com sucesso! Fa√ßa login.");
            }
            location.reload();
        };

        function iniciarSistema() {
            telas.login.classList.add('oculto');
            telas.dash.classList.remove('oculto');
            const isGuru = usuarioAtual.role === 'guru';
            
            document.getElementById('welcome-msg').innerText = `Ol√°, ${usuarioAtual.nome.split(' ')[0]}`;
            if(isGuru) {
                document.getElementById('nav-config-guru').classList.remove('oculto');
                document.getElementById('nav-reclamacoes').classList.remove('oculto');
                document.getElementById('nav-fazer-reclamacao').classList.add('oculto');
                document.getElementById('btn-novo-pedido').classList.add('oculto');
                document.getElementById('mini-guru-card').classList.add('oculto');
                // CORRE√á√ÉO: Removemos a refer√™ncia ao ID 'btn-admin-recl' que n√£o existia
            } else {
                document.getElementById('nav-config-guru').classList.add('oculto');
                document.getElementById('nav-reclamacoes').classList.add('oculto');
            }

            lerPedidosDoFirebase();
            carregarPerfilPublicoGuru(); 
        }

        const views = { pedidos: document.getElementById('view-pedidos'), perfilAluno: document.getElementById('view-perfil-aluno'), configGuru: document.getElementById('view-config-guru'), reclamacoes: document.getElementById('view-reclamacoes') };
        function switchView(name) { Object.values(views).forEach(v => v.classList.add('oculto')); views[name].classList.remove('oculto'); }

        document.getElementById('nav-pedidos').onclick = () => switchView('pedidos');
        document.getElementById('nav-perfil').onclick = () => {
            if(usuarioAtual.role === 'guru') switchView('configGuru');
            else { switchView('perfilAluno'); document.getElementById('perf-nome').value=usuarioAtual.nome; document.getElementById('perf-zap').value=usuarioAtual.zap; document.getElementById('perf-curso').value=usuarioAtual.curso||""; document.getElementById('perf-bio').value=usuarioAtual.bio||""; }
        };
        document.getElementById('nav-config-guru').onclick = () => switchView('configGuru');
        document.getElementById('nav-reclamacoes').onclick = () => { switchView('reclamacoes'); lerReclamacoes(); };
        document.getElementById('nav-fazer-reclamacao').onclick = () => document.getElementById('modal-reclamacao').classList.remove('oculto');
        document.getElementById('nav-ajuda').onclick = () => document.getElementById('modal-ajuda').classList.remove('oculto');
        document.getElementById('btn-sair').onclick = () => location.reload();

        document.querySelectorAll('.tab-link').forEach(btn => {
            btn.onclick = () => { document.querySelectorAll('.tab-link').forEach(b => b.classList.remove('active')); btn.classList.add('active'); filtroAtual = btn.getAttribute('data-tab'); lerPedidosDoFirebase(); };
        });

        function lerPedidosDoFirebase() {
            onSnapshot(query(collection(db, "pedidos"), orderBy("data", "desc")), (snapshot) => {
                const lista = document.getElementById('lista-pedidos'); lista.innerHTML = "";
                let countTotal=0, countAberto=0, countConcluido=0;

                snapshot.forEach((docSnap) => {
                    const p = docSnap.data(); const pid = docSnap.id;
                    if(usuarioAtual.role === 'guru' || p.emailAluno === usuarioAtual.email) {
                        countTotal++;
                        if(['Em An√°lise','Proposta Recebida','Contraproposta'].includes(p.status)) countAberto++;
                        if(['Finalizado','Avaliado'].includes(p.status)) countConcluido++;
                    }
                    if(usuarioAtual.role === 'student' && p.emailAluno !== usuarioAtual.email) return;
                    
                    let mostrar = false;
                    if(filtroAtual === 'aberto' && ['Em An√°lise', 'Proposta Recebida', 'Contraproposta', 'Pagamento Recusado'].includes(p.status)) mostrar = true;
                    if(filtroAtual === 'andamento' && ['Pago', 'Verificando Pagamento'].includes(p.status)) mostrar = true;
                    if(filtroAtual === 'finalizado' && ['Finalizado', 'Avaliado'].includes(p.status)) mostrar = true;
                    if(!mostrar) return;

                    const div = document.createElement('div'); div.className = 'request-card';
                    let btnDelete = (usuarioAtual.role === 'guru') ? `<button class="btn-delete-req" onclick="deletarPedido('${pid}')">√ó</button>` : '';
                    let stColor = 'var(--status-analise)';
                    if(p.status.includes('Proposta')) stColor = 'var(--status-proposta)';
                    if(p.status.includes('Contra')) stColor = 'var(--status-contra)';
                    if(p.status.includes('Verificando')) stColor = 'var(--status-verif)';
                    if(p.status.includes('Recusado')) stColor = 'var(--danger)';
                    if(p.status === 'Pago') stColor = 'var(--status-pago)';
                    if(p.status === 'Finalizado' || p.status === 'Avaliado') stColor = 'var(--status-final)';

                    let anexoHTML = p.arquivo ? `<a href="${p.arquivo}" download="${p.nomeArquivo}" style="color:var(--primary); font-size:12px; text-decoration:none;">üìé Anexo</a>` : '';

                    let html = `${btnDelete}
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            <span style="font-size:12px; color:var(--text-muted);">${p.materia}</span>
                            <span class="req-status" style="background:${stColor}20; color:${stColor};">${p.status}</span>
                        </div>
                        <h3 style="font-size:16px; margin-bottom:5px;">${p.titulo}</h3>
                        <p style="font-size:13px; color:#ccc; flex:1;">${p.desc}</p>
                        <div style="margin:10px 0;">${anexoHTML}</div>
                        <div style="border-top:1px solid #333; margin-top:10px; padding-top:10px;">`;

                    if(p.proposta) {
                        html += `<div style="font-weight:bold; color:var(--status-pago); margin-bottom:5px;">R$ ${p.proposta.valor}</div><div style="font-size:12px; color:#888; font-style:italic; margin-bottom:10px;">"${p.proposta.msg}"</div>`;
                        
                        if(usuarioAtual.role === 'student') {
                            if(p.status === 'Proposta Recebida' || p.status === 'Pagamento Recusado') {
                                if(p.status === 'Pagamento Recusado') html += `<div style="color:var(--danger); font-size:11px; margin-bottom:5px;">Pagamento n√£o identificado. Tente novamente.</div>`;
                                html += `<div style="display:flex; gap:5px;"><button onclick="window.abrirModalPagamento('${pid}', '${p.proposta.valor}')" class="btn-primary" style="flex:1; font-size:12px;">Pagar</button><button onclick="window.abrirModalContra('${pid}')" class="btn-secondary" style="flex:1; font-size:12px;">Contraproposta</button></div>`;
                            } else if (p.status === 'Verificando Pagamento') { html += `<small style="color:var(--status-verif);">Aguardando aprova√ß√£o do Guru.</small>`; }
                        } else if (usuarioAtual.role === 'guru') {
                            if(p.status === 'Contraproposta') {
                                html += `<div style="background:#2a1a2a; padding:10px; border-radius:6px; margin-top:5px;"><div style="font-size:12px; color:var(--status-contra);">Oferta Aluno: <b>R$ ${p.contraproposta.valor}</b></div><div style="display:flex; gap:5px; margin-top:5px;"><button onclick="aceitarContraproposta('${pid}', '${p.contraproposta.valor}')" class="btn-primary" style="flex:1; font-size:11px;">Aceitar</button><button onclick="abrirModalProposta('${pid}', {zapAluno:'${p.zapAluno}', titulo:'${p.titulo}'})" class="btn-secondary" style="flex:1; font-size:11px;">Mudar Valor</button></div></div>`;
                            } else if (p.status === 'Verificando Pagamento') {
                                let ext = (p.comprovante && p.comprovante.startsWith('data:application/pdf')) ? 'pdf' : 'png';
                                html += `<a href="${p.comprovante}" download="Comprovante_${p.aluno}.${ext}" class="btn-secondary" style="display:block; text-align:center; font-size:12px; margin-bottom:5px; text-decoration:none;">üìÑ Ver Comprovante</a><div style="display:flex; gap:5px;"><button onclick="aprovarPagamento('${pid}')" class="btn-primary" style="flex:1; background:var(--status-pago); font-size:11px;">Aprovar</button><button onclick="recusarPagamento('${pid}')" class="btn-primary" style="flex:1; background:var(--danger); font-size:11px;">Recusar</button></div>`;
                            }
                        }

                        if(p.status === 'Pago') {
                            if(usuarioAtual.role === 'guru') html += `<button onclick="abrirModalEntrega('${pid}')" class="btn-primary" style="width:100%; background:var(--status-final);">Entregar Trabalho</button>`;
                            else html += `<small style="color:var(--status-pago);">Pagamento ok! Guru trabalhando...</small>`;
                        } else if(p.status === 'Finalizado' || p.status === 'Avaliado') {
                            if(p.arquivoResolucao) {
                                let extRes = p.arquivoResolucao.startsWith('data:application/pdf') ? 'pdf' : (p.arquivoResolucao.startsWith('data:application/zip') ? 'zip' : 'png');
                                html += `<a href="${p.arquivoResolucao}" download="Resolucao.${extRes}" class="btn-primary" style="display:block; text-align:center; text-decoration:none; margin-bottom:5px;">üì• Baixar Resolu√ß√£o</a>`;
                            }
                            if(usuarioAtual.role === 'student' && p.status !== 'Avaliado') {
                                html += `<button onclick="window.avaliarGuru('${pid}')" class="btn-secondary" style="width:100%;">Avaliar</button>`;
                            }
                            if(p.status === 'Avaliado') {
                                let st = "‚òÖ".repeat(p.avaliacao.nota);
                                html += `<div style="color:#ffeb3b; font-size:12px; margin-top:5px;">${st} "${p.avaliacao.msg}"</div>`;
                            }
                        }
                    } else if(usuarioAtual.role === 'guru') {
                        html += `<button class="btn-primary" onclick="abrirModalProposta('${pid}', {zapAluno:'${p.zapAluno}', titulo:'${p.titulo}'})" style="width:100%;">Fazer Proposta</button>`;
                    } else {
                        html += `<small style="color:#666;">Aguardando Guru...</small>`;
                    }

                    html += `</div>`;
                    div.innerHTML = html;
                    lista.appendChild(div);
                });

                document.getElementById('stat-total').innerText = countTotal;
                document.getElementById('stat-aberto').innerText = countAberto;
                document.getElementById('stat-concluido').innerText = countConcluido;
                if(lista.children.length === 0) lista.innerHTML = '<div style="grid-column: 1/-1; text-align:center; color:#555; padding:40px;">Nenhum pedido encontrado.</div>';
            });
        }

        // --- UPLOADS ---
        const handleUpload = (idInput, idHidden, idDisplay, btnId) => {
            document.getElementById(idInput).addEventListener('change', function(e) {
                const f = e.target.files[0];
                if(f) {
                    if(f.size > 2097152) { alert("Arquivo muito grande (Max 2MB)"); return; }
                    document.getElementById(idDisplay).innerText = f.name;
                    const r = new FileReader();
                    r.onload = (ev) => { document.getElementById(idHidden).value = ev.target.result; if(btnId) document.getElementById(btnId).disabled = false; };
                    r.readAsDataURL(f);
                }
            });
        };
        handleUpload('ped-file', 'ped-file-base64', 'file-name-display');
        handleUpload('pay-file', 'pay-file-base64', 'pay-file-display', 'btn-confirmar-pag');
        handleUpload('entrega-file', 'entrega-file-base64', 'entrega-file-display', 'btn-confirmar-entrega');
        handleUpload('upload-foto', 'conf-img-base64', 'preview-avatar');
        handleUpload('upload-pdf-curriculo', 'conf-pdf-base64', 'display-pdf-name');

        // --- ACTIONS ---
        document.getElementById('btn-novo-pedido').onclick = () => document.getElementById('modal-pedido').classList.remove('oculto');
        document.getElementById('formPedido').onsubmit = async (e) => { e.preventDefault(); try { await addDoc(collection(db, "pedidos"), { aluno: usuarioAtual.nome, emailAluno: usuarioAtual.email, zapAluno: usuarioAtual.zap, materia: document.getElementById('ped-materia').value, titulo: document.getElementById('ped-titulo').value, desc: document.getElementById('ped-desc').value, arquivo: document.getElementById('ped-file-base64').value || null, nomeArquivo: document.getElementById('file-name-display').innerText !== "Nenhum arquivo" ? document.getElementById('file-name-display').innerText : null, data: Date.now(), status: 'Em An√°lise', proposta: null }); alert("Enviado!"); document.querySelector('#modal-pedido .btn-close-modal').click(); e.target.reset(); } catch(err){ alert("Erro"); } };

        let pedidoEmEdicao = null; let idPedidoEmEdicao = null;
        window.abrirModalProposta = (id, dados) => { idPedidoEmEdicao = id; pedidoEmEdicao = dados; document.getElementById('modal-proposta').classList.remove('oculto'); };
        document.getElementById('formProposta').onsubmit = async (e) => { e.preventDefault(); const v = document.getElementById('prop-valor').value; const m = document.getElementById('prop-msg').value; await updateDoc(doc(db, "pedidos", idPedidoEmEdicao), { status: "Proposta Recebida", proposta: { valor: v, msg: m } }); const zl = pedidoEmEdicao.zapAluno ? pedidoEmEdicao.zapAluno.replace(/\D/g,"") : ""; const txt = `Ol√°! Sou o Guru.\nAnalisei: ${pedidoEmEdicao.titulo}\nProposta: R$ ${v}\nDetalhes: ${m}`; if(zl)window.open(`https://wa.me/55${zl}?text=${encodeURIComponent(txt)}`,'_blank'); document.getElementById('modal-proposta').classList.add('oculto'); };

        let idPedidoContra = null;
        window.abrirModalContra = (id) => { idPedidoContra = id; document.getElementById('modal-contraproposta').classList.remove('oculto'); };
        document.getElementById('formContra').onsubmit = async (e) => { e.preventDefault(); await updateDoc(doc(db, "pedidos", idPedidoContra), { status: "Contraproposta", contraproposta: { valor: document.getElementById('contra-valor').value, msg: document.getElementById('contra-msg').value } }); alert("Enviado!"); document.getElementById('modal-contraproposta').classList.add('oculto'); };
        window.aceitarContraproposta = async (id, nv) => { if(confirm(`Aceitar oferta de R$ ${nv}?`)) { await updateDoc(doc(db, "pedidos", id), { status: "Proposta Recebida", "proposta.valor": nv, "proposta.msg": "Oferta aceita pelo Guru!" }); } };

        let idPedidoPagamento = null;
        window.abrirModalPagamento = (id, v) => { idPedidoPagamento = id; document.getElementById('modal-pagamento').classList.remove('oculto'); document.getElementById('display-valor-pix').innerText = `R$ ${v}`; document.getElementById('display-chave-pix').innerText = GLOBAL_CHAVE_PIX; };
        document.getElementById('btn-copiar').onclick = () => navigator.clipboard.writeText(GLOBAL_CHAVE_PIX).then(()=>alert("Copiado!"));
        document.getElementById('btn-confirmar-pag').onclick = async () => { if(!idPedidoPagamento) return; const comp = document.getElementById('pay-file-base64').value; await updateDoc(doc(db, "pedidos", idPedidoPagamento), { status: "Verificando Pagamento", comprovante: comp }); alert("Enviado para an√°lise!"); document.getElementById('modal-pagamento').classList.add('oculto'); };
        window.aprovarPagamento = async (id) => { if(confirm("Dinheiro na conta?")) await updateDoc(doc(db, "pedidos", id), { status: "Pago" }); };
        window.recusarPagamento = async (id) => { if(confirm("Marcar Inv√°lido?")) await updateDoc(doc(db, "pedidos", id), { status: "Pagamento Recusado" }); };

        let idPedidoEntrega = null;
        window.abrirModalEntrega = (id) => { idPedidoEntrega = id; document.getElementById('modal-entrega').classList.remove('oculto'); };
        document.getElementById('btn-confirmar-entrega').onclick = async () => { const arq = document.getElementById('entrega-file-base64').value; await updateDoc(doc(db, "pedidos", idPedidoEntrega), { status: "Finalizado", arquivoResolucao: arq }); alert("Entregue!"); document.getElementById('modal-entrega').classList.add('oculto'); };

        let idAvaliacao = null; let notaAvaliacao = 5;
        window.avaliarGuru = (id) => { idAvaliacao = id; document.getElementById('modal-avaliacao').classList.remove('oculto'); };
        document.querySelectorAll('.star').forEach(s => { s.onclick = function() { notaAvaliacao = this.getAttribute('data-val'); document.querySelectorAll('.star').forEach(st => st.classList.toggle('selected', st.getAttribute('data-val') <= notaAvaliacao)); } });
        document.getElementById('btn-enviar-aval').onclick = async () => { await updateDoc(doc(db, "pedidos", idAvaliacao), { status: "Avaliado", avaliacao: { nota: notaAvaliacao, msg: document.getElementById('aval-msg').value } }); alert("Avaliado!"); document.getElementById('modal-avaliacao').classList.add('oculto'); };
        
        document.getElementById('formReclamacao').onsubmit = async (e) => { e.preventDefault(); await addDoc(collection(db, "reclamacoes"), { aluno: usuarioAtual.nome, email: usuarioAtual.email, zap: usuarioAtual.zap, titulo: document.getElementById('rec-titulo').value, msg: document.getElementById('rec-msg').value, data: Date.now() }); alert("Registrado."); document.getElementById('modal-reclamacao').classList.add('oculto'); };
        
        function lerReclamacoes() {
            onSnapshot(query(collection(db, "reclamacoes"), orderBy("data", "desc")), (snapshot) => {
                const lista = document.getElementById('lista-reclamacoes-admin'); lista.innerHTML = "";
                snapshot.forEach((docSnap) => {
                    const r = docSnap.data(); const div = document.createElement('div'); div.className = 'request-card';
                    div.innerHTML = `<button class="btn-delete-req" onclick="excluirReclamacao('${docSnap.id}')">‚úÖ</button><div style="font-weight:bold; color:var(--danger);">${r.titulo}</div><div style="font-size:12px; color:#aaa;">${r.aluno} (${r.zap})</div><div style="color:#ddd;">"${r.msg}"</div>`;
                    lista.appendChild(div);
                });
                if(lista.children.length===0) lista.innerHTML='<div style="padding:20px; text-align:center; color:#555;">Sem reclama√ß√µes.</div>';
            });
        }
        window.excluirReclamacao = async(id) => { if(confirm("Resolver?")) await deleteDoc(doc(db,"reclamacoes",id)); };

        document.getElementById('formPerfilAluno').onsubmit = (e) => { e.preventDefault(); usuarioAtual.nome = document.getElementById('perf-nome').value; usuarioAtual.zap = document.getElementById('perf-zap').value; usuarioAtual.curso = document.getElementById('perf-curso').value; usuarioAtual.bio = document.getElementById('perf-bio').value; localStorage.setItem('guruUser_'+usuarioAtual.email, JSON.stringify(usuarioAtual)); alert("Salvo!"); document.getElementById('nav-pedidos').click(); };

        // PERFIL GURU (LOAD + REVIEWS)
        async function carregarPerfilPublicoGuru() { 
            const d = await getDoc(doc(db, "config_site", "perfil_guru")); 
            if(d.exists()){ 
                const dd = d.data(); 
                if(dd.pix) GLOBAL_CHAVE_PIX = dd.pix;
                const im = dd.imgBase64 || "https://cdn-icons-png.flaticon.com/512/609/609032.png"; 
                
                // CORRE√á√ÉO: Estes elementos agora existem no HTML!
                if(document.getElementById('guru-avatar-img')) document.getElementById('guru-avatar-img').style.backgroundImage = `url('${im}')`; 
                if(document.getElementById('header-guru-img')) document.getElementById('header-guru-img').style.backgroundImage = `url('${im}')`; 
                if(document.getElementById('guru-title')) document.getElementById('guru-title').innerText = dd.titulo; 
                if(document.getElementById('guru-subtitle')) document.getElementById('guru-subtitle').innerText = dd.sub; 
                
                if(usuarioAtual && usuarioAtual.role==='guru') { 
                    document.getElementById('preview-avatar').style.backgroundImage = `url('${im}')`; 
                    document.getElementById('conf-img-base64').value = im; 
                    document.getElementById('conf-pdf-base64').value = dd.pdfBase64 || "";
                    document.getElementById('conf-bio').value = dd.bio; 
                    document.getElementById('conf-titulo').value = dd.titulo; 
                    document.getElementById('conf-sub').value = dd.sub; 
                    document.getElementById('conf-lattes').value = dd.lattes || "";
                    document.getElementById('conf-pix').value = dd.pix || "";
                } 
                
                document.getElementById('btn-ver-quali-header').onclick = document.getElementById('btn-ver-quali').onclick = async () => { 
                    document.getElementById('qualificacoes-texto').innerText = dd.bio || "Sem info.";
                    
                    const btnLattes = document.getElementById('btn-link-lattes');
                    if(dd.lattes) { btnLattes.href = dd.lattes; btnLattes.style.display = 'block'; } else { btnLattes.style.display = 'none'; }

                    const btnPdf = document.getElementById('btn-link-pdf');
                    if(dd.pdfBase64) { btnPdf.href = dd.pdfBase64; btnPdf.style.display = 'block'; } else { btnPdf.style.display = 'none'; }

                    const listaAval = document.getElementById('lista-avaliacoes-publicas');
                    listaAval.innerHTML = '<div style="color:#666; text-align:center;">Carregando...</div>';
                    
                    const q = query(collection(db, "pedidos"), where("status", "==", "Avaliado"));
                    onSnapshot(q, (snapshot) => {
                        listaAval.innerHTML = "";
                        if(snapshot.empty) { listaAval.innerHTML = '<div style="color:#666; text-align:center;">Nenhuma avalia√ß√£o ainda.</div>'; return; }
                        snapshot.forEach(doc => {
                            const r = doc.data();
                            const stars = "‚òÖ".repeat(r.avaliacao.nota);
                            listaAval.innerHTML += `<div class="review-item"><div class="review-header"><span>${r.aluno.split(' ')[0]}</span> <span class="review-stars">${stars}</span></div><div style="font-size:13px; color:#ddd;">"${r.avaliacao.msg}"</div></div>`;
                        });
                    });
                    document.getElementById('modal-qualificacoes').classList.remove('oculto'); 
                }; 
            } 
        }

        document.getElementById('formConfigGuru').onsubmit = async (e) => { 
            e.preventDefault(); 
            await setDoc(doc(db, "config_site", "perfil_guru"), { 
                titulo: document.getElementById('conf-titulo').value, 
                sub: document.getElementById('conf-sub').value, 
                bio: document.getElementById('conf-bio').value, 
                imgBase64: document.getElementById('conf-img-base64').value,
                pdfBase64: document.getElementById('conf-pdf-base64').value,
                lattes: document.getElementById('conf-lattes').value,
                pix: document.getElementById('conf-pix').value
            }); 
            const ns = document.getElementById('conf-senha').value; 
            if(ns) { localStorage.setItem('guruPass', ns); alert("Senha alterada!"); } 
            else { alert("Salvo!"); } 
            carregarPerfilPublicoGuru(); 
            document.getElementById('nav-pedidos').click(); 
        };

        window.deletarPedido = async (id) => { if(confirm("Excluir?")) await deleteDoc(doc(db, "pedidos", id)); };
        document.querySelectorAll('.btn-close-modal').forEach(b => b.onclick = (e) => { e.preventDefault(); e.target.closest('.modal-overlay').classList.add('oculto'); });
        
        // CORRE√á√ÉO: Adicionamos verifica√ß√£o se o bot√£o existe antes de tentar clicar
        const btnAdminRecl = document.getElementById('btn-admin-recl');
        if(btnAdminRecl) btnAdminRecl.onclick = () => { switchView('reclamacoes'); lerReclamacoes(); };
    </script>
</body>
</html>
