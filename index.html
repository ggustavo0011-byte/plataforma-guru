<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guru da El√©trica - Plataforma</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background-color: #121212; color: #e0e0e0; height: 100vh; overflow: hidden; }
        .oculto { display: none !important; }
        :root {
            --primary: #0095f6; --bg-card: #1e1e1e; --border: #333;
            --status-analise: #2196f3; --status-proposta: #ff9800; --status-contra: #9c27b0;
            --status-verif: #e91e63; --status-pago: #4caf50; --status-final: #607d8b; --danger: #d32f2f;
        }
        /* Layouts simplificados para economizar espa√ßo visual no c√≥digo, mas mantendo o design */
        .split-screen { display: flex; height: 100vh; width: 100%; }
        .left-side { flex: 1; background: #000 url('https://images.unsplash.com/photo-1517077304055-6e89abbf09b0?q=80&w=1476') center/cover; }
        .auth-container { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; background: #121212; }
        .box { background: var(--bg-card); border: 1px solid var(--border); padding: 40px; border-radius: 12px; width: 400px; max-width: 90%; text-align: center; }
        .app-layout { display: flex; height: 100vh; }
        .sidebar { width: 260px; background: #000; padding: 20px; display: flex; flex-direction: column; border-right: 1px solid var(--border); }
        .nav-item { padding: 12px; margin-bottom: 5px; cursor: pointer; color: #aaa; text-align: left; background: none; border: none; width: 100%; border-radius: 5px; }
        .nav-item:hover, .nav-item.active { background: #222; color: #fff; }
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }
        .request-card { background: var(--bg-card); border: 1px solid var(--border); padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        .btn-primary { background: var(--primary); color: #fff; border: none; padding: 10px; border-radius: 6px; cursor: pointer; width: 100%; margin-top: 10px; display: block; text-align: center; text-decoration: none; }
        .btn-secondary { background: transparent; border: 1px solid #555; color: #ccc; padding: 10px; border-radius: 6px; cursor: pointer; width: 100%; margin-top: 10px; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 100; }
        .modal-box { background: var(--bg-card); padding: 30px; border-radius: 12px; width: 500px; max-width: 95%; border: 1px solid var(--border); }
        input, textarea, select { width: 100%; padding: 10px; margin-bottom: 10px; background: #262626; border: 1px solid #444; color: #fff; border-radius: 5px; }
        .custom-file-upload { display: block; padding: 15px; background: #262626; border: 1px dashed #555; text-align: center; cursor: pointer; color: #aaa; margin-top: 10px; }
        @media (max-width: 900px) { .left-side { display: none; } .app-layout { flex-direction: column; } .sidebar { width: 100%; height: auto; flex-direction: row; overflow-x: auto; } }
    </style>
</head>
<body>

    <div id="tela-acesso" class="split-screen">
        <div class="left-side"></div>
        <div class="auth-container">
            <div id="box-login" class="box">
                <h1 style="color:#fff; margin-bottom:20px;">Guru<span>El√©trica</span></h1>
                <form id="formLogin">
                    <input type="text" id="login-user" placeholder="Email" required>
                    <input type="password" id="login-pass" placeholder="Senha" required>
                    <button class="btn-primary">Entrar</button>
                </form>
                <div style="margin-top:15px; font-size:12px; color:#aaa;">
                    <span style="cursor:pointer; text-decoration:underline;" onclick="document.getElementById('modal-reset-senha').classList.remove('oculto')">Esqueci senha</span> | 
                    <span style="cursor:pointer; color:var(--primary);" onclick="document.getElementById('box-login').classList.add('oculto');document.getElementById('box-cadastro').classList.remove('oculto')">Criar Conta</span>
                </div>
            </div>
            <div id="box-cadastro" class="box oculto">
                <h1 style="color:#fff; margin-bottom:20px;">Criar Conta</h1>
                <form id="formCadastro">
                    <input type="text" id="cad-nome" placeholder="Nome" required>
                    <input type="email" id="cad-email" placeholder="Email" required>
                    <input type="tel" id="cad-zap" placeholder="WhatsApp (Com DDD)" required>
                    <input type="text" id="cad-curso" placeholder="Curso" required>
                    <input type="password" id="cad-pass" placeholder="Senha" required>
                    <button class="btn-primary">Cadastrar</button>
                </form>
                <p style="margin-top:15px; font-size:12px; cursor:pointer; color:var(--primary);" onclick="document.getElementById('box-cadastro').classList.add('oculto');document.getElementById('box-login').classList.remove('oculto')">Voltar para Login</p>
            </div>
        </div>
    </div>

    <div id="tela-dashboard" class="app-layout oculto">
        <aside class="sidebar">
            <h3 style="color:#fff; margin-bottom:20px;">‚ö° Guru</h3>
            <button class="nav-item active" onclick="switchView('pedidos')">üìù Pedidos</button>
            <button class="nav-item" onclick="switchView('perfil')">üë§ Perfil</button>
            <button class="nav-item oculto" id="menu-admin-config" onclick="switchView('config')">‚öôÔ∏è Config</button>
            <button class="nav-item oculto" id="menu-admin-recl" onclick="switchView('reclamacoes')">üì¢ Reclama√ß√µes</button>
            <button class="nav-item" onclick="document.getElementById('modal-ajuda').classList.remove('oculto')">‚ùì Ajuda</button>
            <button class="nav-item" style="color:var(--danger);" onclick="logout()">üö™ Sair</button>
        </aside>
        <main class="main-content">
            <h2 id="welcome-msg" style="margin-bottom:20px;">Ol√°!</h2>
            
            <div id="view-pedidos">
                <div style="display:flex; gap:10px; margin-bottom:20px;">
                    <button class="btn-secondary" style="width:auto;" onclick="filtrar('aberto')">Em Aberto</button>
                    <button class="btn-secondary" style="width:auto;" onclick="filtrar('andamento')">Em Andamento</button>
                    <button class="btn-secondary" style="width:auto;" onclick="filtrar('finalizado')">Finalizados</button>
                    <button class="btn-primary" style="width:auto; margin-top:0; margin-left:auto;" id="btn-novo-pedido" onclick="document.getElementById('modal-pedido').classList.remove('oculto')">+ Novo</button>
                </div>
                <div id="lista-pedidos"></div>
            </div>

            <div id="view-perfil" class="oculto">
                <h3>Meu Perfil</h3>
                <form id="formPerfil" style="max-width:500px; margin-top:20px;">
                    <input type="text" id="perf-nome" placeholder="Nome">
                    <input type="text" id="perf-zap" placeholder="WhatsApp">
                    <input type="text" id="perf-curso" placeholder="Curso">
                    <textarea id="perf-bio" placeholder="Bio"></textarea>
                    
                    <div id="area-guru-edit" class="oculto" style="border-top:1px solid #333; margin-top:20px; padding-top:20px;">
                        <h4 style="color:var(--primary); margin-bottom:10px;">Perfil P√∫blico do Guru</h4>
                        <input type="text" id="conf-titulo" placeholder="T√≠tulo">
                        <input type="text" id="conf-sub" placeholder="Subt√≠tulo">
                        <textarea id="conf-bio" placeholder="Sobre mim"></textarea>
                        <input type="url" id="conf-lattes" placeholder="Link Lattes">
                        <label class="custom-file-upload">Foto Perfil <input type="file" id="upload-foto" style="display:none;"></label>
                        <label class="custom-file-upload">PDF Curr√≠culo <input type="file" id="upload-pdf-curriculo" style="display:none;"></label>
                        <input type="hidden" id="conf-img-base64"><input type="hidden" id="conf-pdf-base64">
                    </div>
                    <button class="btn-primary">Salvar</button>
                </form>
            </div>

            <div id="view-config" class="oculto">
                <h3>Configura√ß√µes Admin</h3>
                <label>Chave PIX</label><input type="text" id="conf-pix">
                <label>Nova Senha</label><input type="password" id="conf-senha">
                <button class="btn-primary" onclick="salvarConfigAdmin()">Salvar</button>
            </div>

            <div id="view-reclamacoes" class="oculto">
                <h3>Reclama√ß√µes</h3>
                <div id="lista-reclamacoes"></div>
            </div>
        </main>
    </div>

    <div id="modal-pedido" class="modal-overlay oculto"><div class="modal-box"><h3>Novo Pedido</h3><form id="formPedido"><input id="ped-materia" placeholder="Mat√©ria" required><input id="ped-titulo" placeholder="T√≠tulo" required><textarea id="ped-desc" placeholder="Descri√ß√£o" required></textarea><label class="custom-file-upload">Anexar Arquivo (PDF/IMG/ZIP)<input type="file" id="ped-file" style="display:none;"></label><div id="ped-file-name" style="font-size:12px; color:#aaa; margin-top:5px;"></div><button class="btn-primary">Enviar</button></form><button class="btn-secondary" onclick="fecharModal(this)">Cancelar</button></div></div>
    
    <div id="modal-proposta" class="modal-overlay oculto"><div class="modal-box"><h3>Fazer Proposta</h3><input type="number" id="prop-valor" placeholder="Valor (R$)"><textarea id="prop-msg" placeholder="Detalhes..."></textarea><button class="btn-primary" onclick="enviarProposta()">Enviar no WhatsApp</button><button class="btn-secondary" onclick="fecharModal(this)">Cancelar</button></div></div>
    
    <div id="modal-pagamento" class="modal-overlay oculto"><div class="modal-box"><h3>Pagar</h3><p>Chave PIX: <b id="pay-pix-key" style="color:var(--status-pago);">...</b></p><h2 id="pay-valor" style="margin:10px 0;">R$ 0,00</h2><label class="custom-file-upload">Anexar Comprovante<input type="file" id="pay-file" style="display:none;"></label><button class="btn-primary" onclick="confirmarPagamento()">J√° Fiz o Pagamento</button><button class="btn-secondary" onclick="fecharModal(this)">Cancelar</button></div></div>

    <div id="modal-ajuda" class="modal-overlay oculto"><div class="modal-box"><h3>Ajuda</h3><p>Precisa de suporte ou quer excluir a conta?</p><a href="https://wa.me/5583981023942" target="_blank" class="btn-primary" style="background:var(--status-pago);">Falar no WhatsApp</a><a href="https://wa.me/5583981023942?text=Quero%20excluir%20minha%20conta" target="_blank" class="btn-primary" style="background:var(--danger);">Excluir Conta</a><button class="btn-secondary" onclick="fecharModal(this)">Fechar</button></div></div>
    <div id="modal-reset-senha" class="modal-overlay oculto"><div class="modal-box"><h3>Recuperar Senha</h3><input id="reset-email" placeholder="Email"><button class="btn-primary" onclick="resetSenha()">Enviar</button><button class="btn-secondary" onclick="fecharModal(this)">Fechar</button></div></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail, updatePassword } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, updateDoc, doc, setDoc, getDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // CONFIGURA√á√ÉO DO FIREBASE
        const firebaseConfig = {
          apiKey: "AIzaSyDZhPdplfEEPJAN_tvte37k9sXALutykUs",
          authDomain: "gurueletrica-5f494.firebaseapp.com",
          projectId: "gurueletrica-5f494",
          storageBucket: "gurueletrica-5f494.firebasestorage.app",
          messagingSenderId: "561793673334",
          appId: "1:561793673334:web:a68a9a603ae08875c59757"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app); 
        
        let GLOBAL_CHAVE_PIX = "ggustavo0011@gmail.com"; 
        const GURU_EMAIL = "ggustavo0011@gmail.com"; 
        const GURU_ZAP = "5583981023942"; 
        let usuarioAtual = null; 
        let filtroAtual = 'aberto'; 
        let todosOsPedidos = {}; // Armazena pedidos em mem√≥ria para evitar erros de aspas

        // --- SISTEMA DE ARQUIVOS (H√≠brido) ---
        const LIMITE = 750000; 
        const lerArquivo = (file) => new Promise(resolve => {
            if(!file) return resolve(null);
            if(file.size > LIMITE) return resolve({tipo:'ZAP', nome:file.name});
            const r = new FileReader();
            r.onload = e => resolve({tipo:'BASE64', dados:e.target.result, nome:file.name});
            r.readAsDataURL(file);
        });

        // --- AUTENTICA√á√ÉO ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                let d = {}; try{const s=await getDoc(doc(db,"usuarios",user.uid)); if(s.exists())d=s.data();}catch(e){}
                usuarioAtual = { uid:user.uid, email:user.email, nome:d.nome||"User", role:(user.email===GURU_EMAIL)?'guru':'student' };
                iniciarApp();
            } else {
                document.getElementById('tela-dashboard').classList.add('oculto');
                document.getElementById('tela-acesso').classList.remove('oculto');
            }
        });

        function iniciarApp() {
            document.getElementById('tela-acesso').classList.add('oculto');
            document.getElementById('tela-dashboard').classList.remove('oculto');
            document.getElementById('welcome-msg').innerText = `Bem-vindo, ${usuarioAtual.nome}`;
            
            const isGuru = usuarioAtual.role === 'guru';
            document.getElementById('menu-admin-config').classList.toggle('oculto', !isGuru);
            document.getElementById('menu-admin-recl').classList.toggle('oculto', !isGuru);
            document.getElementById('area-guru-edit').classList.toggle('oculto', !isGuru);
            document.getElementById('btn-novo-pedido').classList.toggle('oculto', isGuru);
            
            carregarPedidos();
            carregarPerfil();
        }

        // --- LISTAGEM E RENDERIZA√á√ÉO ---
        function carregarPedidos() {
            onSnapshot(query(collection(db, "pedidos"), orderBy("data", "desc")), (snap) => {
                const div = document.getElementById('lista-pedidos'); div.innerHTML = "";
                todosOsPedidos = {}; // Limpa mem√≥ria

                snap.forEach(docSnap => {
                    const p = docSnap.data(); const id = docSnap.id;
                    todosOsPedidos[id] = p; // Guarda na mem√≥ria

                    // Filtros de Usu√°rio
                    if(usuarioAtual.role === 'student' && p.emailAluno !== usuarioAtual.email) return;

                    // Filtros de Tab
                    let show = false;
                    if(filtroAtual==='aberto' && ['Em An√°lise','Proposta Recebida','Contraproposta','Pagamento Recusado'].includes(p.status)) show=true;
                    if(filtroAtual==='andamento' && ['Pago','Verificando Pagamento'].includes(p.status)) show=true;
                    if(filtroAtual==='finalizado' && ['Finalizado','Avaliado'].includes(p.status)) show=true;
                    if(!show) return;

                    // Cores
                    let cor = '#2196f3';
                    if(p.status.includes('Proposta')) cor='#ff9800';
                    if(p.status==='Pago') cor='#4caf50';
                    if(p.status==='Finalizado') cor='#607d8b';

                    // HTML do Card
                    let html = `<div class="request-card">
                        <div style="display:flex; justify-content:space-between;">
                            <small style="color:#888">${p.materia}</small>
                            <span style="color:${cor}; font-weight:bold; font-size:12px; border:1px solid ${cor}; padding:2px 8px; border-radius:10px;">${p.status}</span>
                        </div>
                        <h3 style="margin:5px 0;">${p.titulo}</h3>
                        <p style="color:#ccc; font-size:14px;">${p.desc}</p>
                        ${renderAnexo(p)}
                        <hr style="border-color:#333; margin:10px 0;">
                        ${renderAreaAcao(id, p)}
                    </div>`;
                    div.innerHTML += html;
                });
                if(div.innerHTML === "") div.innerHTML = "<p style='text-align:center; color:#555;'>Nenhum pedido aqui.</p>";
            });
        }

        function renderAnexo(p) {
            if(!p.arquivo) return "";
            if(p.arquivo === "Enviado via WhatsApp") return `<div style="font-size:12px; color:#ff9800;">üì≤ Arquivo enviado via WhatsApp</div>`;
            return `<a href="${p.arquivo}" download="${p.nomeArquivo}" style="color:var(--primary); font-size:12px;">üìé Baixar Anexo</a>`;
        }

        function renderAreaAcao(id, p) {
            // L√≥gica do GURU
            if(usuarioAtual.role === 'guru') {
                if(p.status === 'Em An√°lise' || p.status === 'Contraproposta') 
                    return `<button class="btn-primary" onclick="prepareProposta('${id}')">Fazer Proposta</button>`;
                if(p.status === 'Verificando Pagamento') 
                    return `<div style="display:flex; gap:5px;"><button class="btn-primary" onclick="aprovar('${id}')">Aprovar Pagamento</button><button class="btn-secondary" onclick="recusar('${id}')">Recusar</button></div>`;
                if(p.status === 'Pago') 
                    return `<button class="btn-primary" onclick="alert('Envie a resolu√ß√£o pelo WhatsApp!')">Entregar (WhatsApp)</button><button class="btn-secondary" onclick="finalizar('${id}')">Marcar Entregue</button>`;
                return `<small style="color:#666;">Aguardando aluno.</small>`;
            }
            
            // L√≥gica do ALUNO
            if(p.proposta) {
                // SE TIVER PROPOSTA, MOSTRA O VALOR!
                let html = `<div style="background:#333; padding:10px; border-radius:5px; margin-bottom:10px;">
                    <div style="color:var(--status-pago); font-weight:bold; font-size:18px;">R$ ${p.proposta.valor}</div>
                    <div style="font-size:13px; font-style:italic;">"${p.proposta.msg}"</div>
                </div>`;

                if(p.status === 'Proposta Recebida' || p.status === 'Pagamento Recusado') {
                    html += `<button class="btn-primary" onclick="preparePagamento('${id}', '${p.proposta.valor}')">Pagar Agora</button>`;
                } else if (p.status === 'Verificando Pagamento') {
                    html += `<small style="color:#aaa;">Pagamento em an√°lise...</small>`;
                } else if (p.status === 'Pago') {
                    html += `<small style="color:var(--status-pago);">Pagamento Aprovado! Guru trabalhando.</small>`;
                }
                return html;
            }
            
            return `<small style="color:#666;">Aguardando an√°lise do Guru...</small>`;
        }

        // --- A√á√ïES (T√âCNICA DE ID PARA MEM√ìRIA) ---
        let idTemp = null;
        window.prepareProposta = (id) => { idTemp = id; document.getElementById('modal-proposta').classList.remove('oculto'); }
        window.enviarProposta = async () => {
            const v = document.getElementById('prop-valor').value;
            const m = document.getElementById('prop-msg').value;
            if(!v) return alert("Digite o valor");
            try {
                await updateDoc(doc(db, "pedidos", idTemp), {
                    status: "Proposta Recebida",
                    proposta: { valor: v, msg: m }
                });
                // Link Zap Guru -> Aluno
                const ped = todosOsPedidos[idTemp];
                const zap = ped.zapAluno.replace(/\D/g, "");
                window.open(`https://wa.me/55${zap}?text=${encodeURIComponent(`Ol√° ${ped.aluno}! Analisei seu pedido "${ped.titulo}".\nValor: R$ ${v}\nObs: ${m}\n\nAcesse a plataforma para pagar.`)}`, '_blank');
                document.getElementById('modal-proposta').classList.add('oculto');
            } catch(e) { alert("Erro ao enviar: " + e.message); }
        };

        window.preparePagamento = (id, valor) => {
            idTemp = id;
            document.getElementById('pay-pix-key').innerText = GLOBAL_CHAVE_PIX;
            document.getElementById('pay-valor').innerText = "R$ " + valor;
            document.getElementById('modal-pagamento').classList.remove('oculto');
        };

        window.confirmarPagamento = async () => {
            const file = document.getElementById('pay-file').files[0];
            const data = await lerArquivo(file);
            let comp = null;
            if(data) comp = (data.tipo==='BASE64') ? data.dados : "Enviado via WhatsApp";
            
            await updateDoc(doc(db, "pedidos", idTemp), { status: "Verificando Pagamento", comprovante: comp });
            document.getElementById('modal-pagamento').classList.add('oculto');
            alert("Enviado! Se o comprovante era grande, envie no WhatsApp.");
            if(data?.tipo==='ZAP') window.open(`https://wa.me/${GURU_ZAP}`, '_blank');
        };

        window.aprovar = async(id) => { if(confirm("Confirmar $$$?")) await updateDoc(doc(db,"pedidos",id),{status:"Pago"}); };
        window.recusar = async(id) => { if(confirm("Recusar?")) await updateDoc(doc(db,"pedidos",id),{status:"Pagamento Recusado"}); };
        window.finalizar = async(id) => { if(confirm("Finalizar?")) await updateDoc(doc(db,"pedidos",id),{status:"Finalizado"}); };

        // --- OUTRAS FUN√á√ïES ---
        window.switchView = (v) => {
            document.getElementById('view-pedidos').classList.add('oculto');
            document.getElementById('view-perfil').classList.add('oculto');
            document.getElementById('view-config').classList.add('oculto');
            document.getElementById('view-reclamacoes').classList.add('oculto');
            document.getElementById('view-'+v).classList.remove('oculto');
        };
        window.filtrar = (f) => { filtroAtual = f; carregarPedidos(); };
        window.fecharModal = (el) => el.closest('.modal-overlay').classList.add('oculto');
        window.logout = async () => { await signOut(auth); location.reload(); };

        // Cadastro Pedido
        document.getElementById('formPedido').onsubmit = async (e) => {
            e.preventDefault();
            const f = document.getElementById('ped-file').files[0];
            const data = await lerArquivo(f);
            let arq = null; if(data) arq = (data.tipo==='BASE64') ? data.dados : "Enviado via WhatsApp";
            
            await addDoc(collection(db, "pedidos"), {
                aluno: usuarioAtual.nome, emailAluno: usuarioAtual.email, zapAluno: usuarioAtual.zap,
                materia: document.getElementById('ped-materia').value,
                titulo: document.getElementById('ped-titulo').value,
                desc: document.getElementById('ped-desc').value,
                arquivo: arq, nomeArquivo: data?.nome,
                data: Date.now(), status: "Em An√°lise", proposta: null
            });
            document.getElementById('modal-pedido').classList.add('oculto');
            e.target.reset();
            if(data?.tipo==='ZAP') {
                alert("Arquivo grande! Redirecionando para o WhatsApp...");
                window.open(`https://wa.me/${GURU_ZAP}?text=Envio do arquivo grande do pedido`, '_blank');
            } else { alert("Pedido Enviado!"); }
        };

        // Login/Cadastro/Perfil... (C√≥digo padr√£o mantido simplificado)
        document.getElementById('formLogin').onsubmit=async(e)=>{e.preventDefault();try{await signInWithEmailAndPassword(auth, document.getElementById('login-user').value, document.getElementById('login-pass').value);}catch(e){alert("Erro login");}};
        document.getElementById('formCadastro').onsubmit=async(e)=>{e.preventDefault();try{const c=await createUserWithEmailAndPassword(auth,document.getElementById('cad-email').value,document.getElementById('cad-pass').value);await setDoc(doc(db,"usuarios",c.user.uid),{nome:document.getElementById('cad-nome').value,email:document.getElementById('cad-email').value,zap:document.getElementById('cad-zap').value,role:'student'});window.open(`https://wa.me/${GURU_ZAP}`,'_blank');location.reload();}catch(e){alert(e.message);}};
        document.getElementById('formPerfil').onsubmit=async(e)=>{e.preventDefault();await updateDoc(doc(db,"usuarios",usuarioAtual.uid),{nome:document.getElementById('perf-nome').value,zap:document.getElementById('perf-zap').value,curso:document.getElementById('perf-curso').value,bio:document.getElementById('perf-bio').value});alert("Salvo!");};
        
        async function carregarPerfil() {
            const d=await getDoc(doc(db,"config_site","perfil_guru"));
            if(d.exists()) { const dd=d.data(); if(dd.pix) GLOBAL_CHAVE_PIX=dd.pix; }
            if(usuarioAtual.role!=='guru') {
                const u=await getDoc(doc(db,"usuarios",usuarioAtual.uid));
                if(u.exists()) { const ud=u.data(); document.getElementById('perf-nome').value=ud.nome; document.getElementById('perf-zap').value=ud.zap; document.getElementById('perf-curso').value=ud.curso||""; document.getElementById('perf-bio').value=ud.bio||""; }
            }
        }
    </script>
</body>
</html>
